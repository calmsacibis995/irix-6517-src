#
#!smake
#
# Makefile for the rpc.lockd subdirectory
#
# $Revision: 1.2 $

include	${ROOT}/usr/include/make/commondefs

LINTFLAGS= -woff 91,102

CTAGOPTS=-tw

# GENERATED_FILES is a list of all of the files generated by rpcgen
#
GENERATED_HFILES = lk_test.h
GENERATED_CFILES = lk_test_svc.c lk_test_xdr.c lk_test_clnt.c
GENERATED_FILES = $(GENERATED_HFILES) $(GENERATED_CFILES)

#
# SERVER_FILES is a list of files specific to the server
#
SERVER_FILES = lk_test_svc.c server_procs.c
SERVER_OBJS = ${SERVER_FILES:.c=.o}

#
# CLIENT_FILES is a list of files specific to the client
#
CLIENT_FILES = lk_test.c lk_test_clnt.c remoteops.c
CLIENT_OBJS = ${CLIENT_FILES:.c=.o}

#
# COMMON_FILES is a list of files common to the client and the server
#
COMMON_FILES = lk_test_xdr.c print.c fileops.c localops.c ../common/util.c
COMMON_OBJS = ${COMMON_FILES:.c=.o}

CFILES = $(GENERATED_CFILES) $(SERVER_FILES) $(CLIENT_FILES) $(COMMON_FILES)

LDIRT= $(GENERATED_FILES)

#
# PROGRAMS is a list of programs to be built
#
TARGETS = lk_test_svc lk_test

# define NDEBUG to turn off assertions
# define _IRIX for building on IRIX
# define _SUNOS for building on SunOS
#CFLAGS = -DNDEBUG
LCDEFS = -D_IRIX
LCOPTS = -g
LCINCS = -I../common
LIBS = 

default: ${TARGETS}

include	${COMMONRULES}

lk_test_svc:	$(GENERATED_FILES) $(SERVER_OBJS) $(COMMON_OBJS)
	$(CCF) $(LCOPTS) $(LCDEFS) $(LDFLAGS) -o $@ $(SERVER_OBJS) $(COMMON_OBJS) $(LIBS)

lk_test:	$(GENERATED_FILES) $(CLIENT_OBJS) $(COMMON_OBJS)
	$(CCF) $(LCOPTS) $(LCDEFS) -o $@ $(CLIENT_OBJS) $(COMMON_OBJS) $(LDFLAGS) $(LIBS)

$(GENERATED_FILES):	lk_test.x
	${TOOLROOTSAFE} $(TOOLROOT)/usr/bin/rpcgen -P lk_test.x

install:	default
