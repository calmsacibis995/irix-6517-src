<!-- Produced by version 4.3 (11/99) of SGI Frame/SGIDOCBK SGML translator -->
<CHAPTER ID="LE94130-PARENT"><TITLE ID="LE94130-TITLE">Performing Disk Administration Procedures</TITLE><PARA>This chapter describes administration procedures for disks and their device files.</PARA>
<PARA>The major sections in this chapter are:</PARA>
<ITEMIZEDLIST><LISTITEM><PARA><XREF LINKEND="LE75051-PARENT"></PARA></LISTITEM>
<LISTITEM><PARA><XREF LINKEND="LE27674-PARENT"></PARA></LISTITEM>
<LISTITEM><PARA><XREF LINKEND="LE85263-PARENT"></PARA></LISTITEM>
<LISTITEM><PARA><XREF LINKEND="LE52746-PARENT"></PARA></LISTITEM>
<LISTITEM><PARA><XREF LINKEND="LE22642-PARENT"></PARA></LISTITEM>
<LISTITEM><PARA><XREF LINKEND="LE30595-PARENT"></PARA></LISTITEM>
<LISTITEM><PARA><XREF LINKEND="LE38803-PARENT"></PARA></LISTITEM>
<LISTITEM><PARA><XREF LINKEND="LE50592-PARENT"></PARA></LISTITEM>
<LISTITEM><PARA><XREF LINKEND="LE12802-PARENT"></PARA></LISTITEM>
<LISTITEM><PARA><XREF LINKEND="LE43185-PARENT"></PARA></LISTITEM>
<LISTITEM><PARA><XREF LINKEND="LE77121-PARENT"></PARA></LISTITEM>
<LISTITEM><PARA><XREF LINKEND="LE71954-PARENT"></PARA></LISTITEM>
</ITEMIZEDLIST>
<PARA>Administration procedures for filesystems and XLV logical volumes are described in later chapters of this guide.</PARA>
<SECTION  ID="LE75051-PARENT"><TITLE  ID="LE75051-TITLE">Listing the Disks on a System With hinv</TITLE><PARA>You can list the disks connected to a system by issuing this <COMMAND>hinv</COMMAND> command from IRIX:</PARA>
<PROGRAMLISTING>
#<USERINPUT>&ensp;hinv -c disk</USERINPUT>&ensp;
</PROGRAMLISTING>
<PARA>The output lists the disk controllers and disks present on a system, for example:</PARA>
<PROGRAMLISTING>
Integral SCSI controller 0: Version WD33C93B, revision D
&ensp; Disk drive: unit 2 on SCSI controller 0
&ensp; Disk drive: unit 1 on SCSI controller 0
</PROGRAMLISTING>
<PARA><INDEXTERM ID="ITch2-0"><PRIMARY>disk drives</PRIMARY>
<SECONDARY>identifying controller number and drive address</SECONDARY>
</INDEXTERM>
<INDEXTERM ID="ITch2-1"><PRIMARY>unit number. <EMPHASIS>See</EMPHASIS>
 drive addresses.</PRIMARY>
</INDEXTERM>
<INDEXTERM ID="ITch2-2"><PRIMARY>drive addresses</PRIMARY>
<SECONDARY>identifying</SECONDARY>
</INDEXTERM>
<INDEXTERM ID="ITch2-3"><PRIMARY>controllers</PRIMARY>
<SECONDARY> identifying controller number</SECONDARY>
</INDEXTERM>
This output shows a single integral SCSI controller whose number is 0 and two disk drives. These disks are at drive addresses 1 and 2. In <COMMAND>hinv</COMMAND> output, drive addresses are called units. They are also sometimes called unit numbers. Each disk is uniquely identified by the combination of its controller number and drive address. </PARA>
<PARA>If you are in the PROM Monitor, you can also give the <COMMAND>hinv</COMMAND> command from the <INTERFACE>Command Monitor</INTERFACE>:</PARA>
<PARA>&gt;&gt; <USERINPUT>hinv</USERINPUT>&ensp;</PARA>
<PARA>Output for SCSI disks looks like this:</PARA>
<PROGRAMLISTING>
SCSI Disk: scsi(0)disk(1)
SCSI Disk: scsi(0)disk(2)
</PROGRAMLISTING>
<PARA>In this output, the controller number is the &ldquo;scsi&rdquo; number and the drive address is the &ldquo;disk&rdquo; number. The type of controller is not listed. As a rule, workstations have integral controllers and servers may have integral SCSI controllers or non-integral controllers that are SCSI or VME. On some Challenge systems, the output of <COMMAND>hinv</COMMAND> in the PROM monitor shows only disks on the boot IOP (I/O processor).</PARA>
<PARA><INDEXTERM ID="ITch2-4"><PRIMARY>device files</PRIMARY>
<SECONDARY>using as command arguments</SECONDARY>
</INDEXTERM>
The controller number and drive addresses of disks are specified, using a variety of syntax, as arguments to the IRIX disk and filesystem commands, such as <COMMAND>fx</COMMAND>, <COMMAND>prtvtoc</COMMAND>, <COMMAND>dvhtool</COMMAND>, and <COMMAND>mkfs</COMMAND>. For example, for a disk on controller 0 at drive address 1:</PARA>
<ITEMIZEDLIST><LISTITEM><PARA>To specify the disk on an <COMMAND>fx</COMMAND> command line, the command line is:</PARA>
<PROGRAMLISTING>
# <USERINPUT>fx "dksc(0,1)"</USERINPUT>&ensp;
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>To specify the disk (actually, its volume header) on a <COMMAND>prtvtoc</COMMAND> command line, either of these two commands can be used:</PARA>
<PROGRAMLISTING>
# <USERINPUT>prtvtoc /dev/rdsk/dks0d1vh</USERINPUT>&ensp;
# <USERINPUT>prtvtoc dks0d1vh</USERINPUT>&ensp;
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>To specify the disk 1 (actually, its volume header) on a <COMMAND>dvhtool</COMMAND> command line, the command is:</PARA>
<PROGRAMLISTING>
# <USERINPUT>dvhtool /dev/rdsk/dks0d1vh</USERINPUT>&ensp;
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>To specify partition 7 of the second disk above on a <COMMAND>mkfs</COMMAND> command line for an XFS filesystem, the command is:</PARA>
<PROGRAMLISTING>
# <USERINPUT>mkfs /dev/rdsk/dks0d1s7</USERINPUT>&ensp;
</PROGRAMLISTING>
<TIP><PARA>You can use the Disk Manager in the System Toolchest to get information about the disks on a system. For instructions, see the section <LINK BOOK="PerSysAdmin" EXTREF="48385">&ldquo;Disk Manager&rdquo;</LINK>
 in Chapter 3 of the <CITETITLE>Personal System Administration Guide</CITETITLE>.</PARA>
</TIP>
</LISTITEM>
</ITEMIZEDLIST>
</SECTION>
<SECTION  ID="LE27674-PARENT"><TITLE  ID="LE27674-TITLE">Formatting and Initializing a Disk With fx</TITLE><PARA><INDEXTERM ID="ITch2-5"><PRIMARY>formatting disks</PRIMARY>
</INDEXTERM>
<INDEXTERM ID="ITch2-6"><PRIMARY>initializing a disk</PRIMARY>
</INDEXTERM>
When you format a disk, you write timing marks and divide the disk into tracks and sectors that can be addressed by the disk controller. SCSI disks are shipped preformatted; formatting a SCSI disk is rarely required. Formatting is done by <COMMAND>fx</COMMAND>; see the <COMMAND>fx(1M)</COMMAND> reference page for details.</PARA>
<CAUTION><PARA>Formatting a disk results in the loss of all data on the disk. It is recommended only for experienced IRIX system administrators.</PARA>
</CAUTION>
<PARA>Formatting a disk destroys information about bad areas on the disk (called <FIRSTTERM>bad blocks</FIRSTTERM>). Identifying and handling bad blocks is also done by <COMMAND>fx</COMMAND>; see the <COMMAND>fx</COMMAND>(1M) reference page for details.</PARA>
<CAUTION><PARA>Using <COMMAND>fx</COMMAND> for bad block handling usually results in the loss of all data on the block. It is recommended only for experienced IRIX system administrators.</PARA>
</CAUTION>
<PARA>Initializing a disk consists of creating a volume header for a disk. Disks supplied by Silicon Graphics are shipped with a volume header, so initialization is not necessary. Disks from third-party vendors or disks whose volume headers have been destroyed must be initialized to create a volume header. Initializing disks is done by <COMMAND>fx</COMMAND>. No explicit commands are necessary; <COMMAND>fx</COMMAND> automatically detects if no volume header is present and creates one. (See <XREF LINKEND="LE38803-PARENT"> for information on invoking <COMMAND>fx</COMMAND>.) When <COMMAND>fx</COMMAND> creates a volume header, a prompt asks if you want to write the volume header; reply yes.</PARA>
<TIP><PARA>You can use the Disk Information window of the Disk Manager in the System Toolchest to perform disk initialization and other tasks. For more information, see the section <LINK BOOK="PerSysAdmin" EXTREF="64311">&ldquo;Managing Disk Drives&rdquo;</LINK>
 in Chapter 3 of the <CITETITLE>Personal System Administration Guide</CITETITLE>.</PARA>
</TIP>
</SECTION>
<SECTION  ID="LE85263-PARENT"><TITLE  ID="LE85263-TITLE">Adding Files to the Volume Header With dvhtool</TITLE><PARA><INDEXTERM ID="ITch2-7"><PRIMARY><COMMAND>dvhtool</COMMAND>
 command</PRIMARY>
<SECONDARY><COMMAND>adding files to the volume header</COMMAND>
</SECONDARY>
</INDEXTERM>
<INDEXTERM ID="ITch2-8"><PRIMARY>volume header</PRIMARY>
<SECONDARY>adding files</SECONDARY>
</INDEXTERM>
As explained in <XREF LINKEND="LE18926-TITLE">, the volume header of system disks must contain a copy of the program <COMMAND>sash</COMMAND>. The procedure in this section explains how to put <COMMAND>sash</COMMAND> or other programs into a volume header. Before performing this procedure, review the discussion of <COMMAND>dvhtool</COMMAND> in <XREF LINKEND="LE18926-TITLE">.</PARA><PARA>When you add programs to the volume header of a disk, there are two sources for those programs. One is the <FILENAME>/stand</FILENAME> directory of the system and the other is the <FILENAME>/stand</FILENAME> directory on an IRIX software release CD. The <FILENAME>/stand</FILENAME> directory on a CD (usually <FILENAME>/CDROM/stand</FILENAME> after the CD is mounted) contains copies of <COMMAND>sash</COMMAND>, <COMMAND>fx</COMMAND>, and <COMMAND>ide</COMMAND> that are processor-specific.</PARA>
<PARA>As superuser, perform this procedure to add programs to a volume header:</PARA>
<ORDEREDLIST><LISTITEM><PARA>Invoke <COMMAND>dvhtool</COMMAND> with the raw device name of the volume header of the disk as an argument; for example:</PARA>
<PROGRAMLISTING>
# <USERINPUT>dvhtool /dev/rdsk/dks0d2vh</USERINPUT>&ensp;
</PROGRAMLISTING>
<PARA>(See the <XREF LINKEND="LE59537-TITLE"> for information on constructing the device name.)</PARA></LISTITEM>
<LISTITEM><PARA><INDEXTERM ID="ITch2-9"><PRIMARY><COMMAND>dvhtool</COMMAND>
 command</PRIMARY>
<SECONDARY><COMMAND>examining a volume header</COMMAND>
</SECONDARY>
</INDEXTERM>
<INDEXTERM ID="ITch2-10"><PRIMARY>volume header</PRIMARY>
<SECONDARY>examining with <COMMAND>dvhtool</COMMAND>
</SECONDARY>
</INDEXTERM>
Display the volume directory portion of the volume header by using the <COMMAND>vd</COMMAND>  (volume directory) and <COMMAND>l</COMMAND> (list) commands:</PARA>
<PROGRAMLISTING>
Command? (read, vd, pt, dp, write, bootfile, or quit): <USERINPUT>vd</USERINPUT>
(d FILE, a UNIX_FILE FILE, c UNIX_FILE FILE, g FILE UNIX_FILE or l)?
&ensp;       <USERINPUT>l</USERINPUT>

Current contents:
&ensp;       File name        Length     Block #
&ensp;       sgilabel            512           2
&ensp;       sash             159232           3
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>For each program that you want to copy to the volume header, use the <FILENAME>a</FILENAME> (add) command. For example, to copy <COMMAND>sash</COMMAND> from the <FILENAME>/stand</FILENAME> directory to <COMMAND>sash</COMMAND> in the volume header, use this command:</PARA>
<PROGRAMLISTING>
(d FILE, a UNIX_FILE FILE, c UNIX_FILE FILE, g FILE UNIX_FILE or l)?
&ensp;       <USERINPUT>a /stand/sash sash</USERINPUT>
</PROGRAMLISTING>
<PARA>As another example, to copy <COMMAND>sash</COMMAND> from a CD to an IP20 or IP22 system (an Indy&trade;), use this command:</PARA>
<PROGRAMLISTING>
(d FILE, a UNIX_FILE FILE, c UNIX_FILE FILE, g FILE UNIX_FILE or l)?
&ensp;       <USERINPUT>a /CDROM/stand/sashARCS sash</USERINPUT>
</PROGRAMLISTING>
<PARA>CDs contain multiple processor-specific versions of <COMMAND>sash</COMMAND>; <XREF LINKEND="LE33413-TITLE"> lists the version of <COMMAND>sash</COMMAND> for each processor type. </PARA>
</LISTITEM>
<LISTITEM><PARA>Confirm your changes by listing the contents of the volume with the <COMMAND>l</COMMAND> (list) command: </PARA>
<PROGRAMLISTING>
(d FILE, a UNIX_FILE FILE, c UNIX_FILE FILE, g FILE UNIX_FILE or l)?
&ensp;       <USERINPUT>l</USERINPUT>

Current contents:
&ensp;       File name        Length     Block #
&ensp;       sgilabel            512           2
&ensp;       sash             159232           3
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Make the changes permanent by writing the changes to the volume header using the <COMMAND>quit</COMMAND> command to exit this &ldquo;submenu&rdquo; and the <COMMAND>write</COMMAND> command:</PARA>
<PROGRAMLISTING>
(d FILE, a UNIX_FILE FILE, c UNIX_FILE FILE, g FILE UNIX_FILE or l)?
&ensp;       <USERINPUT>quit</USERINPUT>

Command? (read, vd, pt, dp, write, bootfile, or quit): <USERINPUT>write</USERINPUT>
Quit <COMMAND>dvhtool</COMMAND> by giving the quit command:
Command? (read, vd, pt, dp, write, bootfile, or quit): <USERINPUT>quit</USERINPUT>
</PROGRAMLISTING>
</LISTITEM>
</ORDEREDLIST>
</SECTION>
<SECTION  ID="LE52746-PARENT"><TITLE  ID="LE52746-TITLE">Removing Files in the Volume Header With dvhtool</TITLE><CAUTION><PARA>The procedure in this section can result in the loss of data if it is not performed properly. It is recommended only for experienced IRIX system administrators.</PARA>
</CAUTION>
<PARA><INDEXTERM ID="ITch2-11"><PRIMARY><COMMAND>dvhtool</COMMAND>
 command</PRIMARY>
<SECONDARY><COMMAND>removing files in the volume header</COMMAND>
</SECONDARY>
</INDEXTERM>
<INDEXTERM ID="ITch2-12"><PRIMARY>volume header</PRIMARY>
<SECONDARY>removing files</SECONDARY>
</INDEXTERM>
<INDEXTERM ID="ITch2-13"><PRIMARY>logical volumes</PRIMARY>
<SECONDARY>removing labels in volume headers</SECONDARY>
</INDEXTERM>
<INDEXTERM ID="ITch2-14"><PRIMARY>logical volume labels</PRIMARY>
<SECONDARY>removing with <COMMAND>dvhtool</COMMAND>
</SECONDARY>
</INDEXTERM>
You can use the following procedure to remove XLV logical volume labels (for example <FILENAME>xlvlab</FILENAME>) and files (for example, <COMMAND>sash</COMMAND>) from the volume header of a disk. Before performing this procedure, review the discussion of <COMMAND>dvhtool</COMMAND> in <XREF LINKEND="LE18926-TITLE">.</PARA><ORDEREDLIST><LISTITEM><PARA>Using <COMMAND>hinv</COMMAND>, determine the controller and drive addresses of the disk that has the volume header you want to change. In this procedure, the example commands and output assume that the disk is on controller 0, drive address 2. Substitute the controller and drive addresses of your disk.</PARA>
</LISTITEM>
<LISTITEM><PARA>As superuser, invoke <COMMAND>dvhtool</COMMAND> with the raw device name of the volume header of the disk, for example:</PARA>
<PROGRAMLISTING>
# <USERINPUT>dvhtool /dev/rdsk/dks0d2vh</USERINPUT>&ensp;
</PROGRAMLISTING>
<PARA>(See the section <XREF LINKEND="LE59537-TITLE"> for information on constructing the device name.)</PARA></LISTITEM>
<LISTITEM><PARA>Display the volume directory portion of the volume header by answering two prompts:</PARA>
<PROGRAMLISTING>
Command? (read, vd, pt, dp, write, bootfile, or quit): <USERINPUT>vd</USERINPUT>
(d FILE, a UNIX_FILE FILE, c UNIX_FILE FILE, g FILE UNIX_FILE or l)?
&ensp;       <USERINPUT>l</USERINPUT>

Current contents:
&ensp;       File name        Length     Block #
&ensp;       sgilabel            512           2
&ensp;       xlvlab            10752           3
&ensp;       lvlab2              512          26
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Use the <COMMAND>d</COMMAND> command to delete the file; for example, <FILENAME>xlvlab</FILENAME>:</PARA>
<PROGRAMLISTING>
(d FILE, a UNIX_FILE FILE, c UNIX_FILE FILE, g FILE UNIX_FILE or l)?
&ensp;       <USERINPUT>d xlvlab</USERINPUT>
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA><INDEXTERM ID="ITch2-15"><PRIMARY><COMMAND>lvlab</COMMAND>
 logical volume labels</PRIMARY>
</INDEXTERM>
To delete additional files, continue to use the <COMMAND>d</COMMAND> command, for example:</PARA>
<PROGRAMLISTING>
(d FILE, a UNIX_FILE FILE, c UNIX_FILE FILE, g FILE UNIX_FILE or l)?
&ensp;       <USERINPUT>d lvlab2</USERINPUT>
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>List the volume directory again to confirm that the files are gone:</PARA>
<PROGRAMLISTING>
(d FILE, a UNIX_FILE FILE, c UNIX_FILE FILE, g FILE UNIX_FILE or l)?
&ensp;       <USERINPUT>l</USERINPUT>

Current contents:
&ensp;       File name        Length     Block #
&ensp;       sgilabel            512           2
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Exit this &ldquo;menu&rdquo; and write the changes to the volume header:</PARA>
<PROGRAMLISTING>
(d FILE, a UNIX_FILE FILE, c UNIX_FILE FILE, g FILE UNIX_FILE or l)?
&ensp;       <USERINPUT>q</USERINPUT>

Command? (read, vd, pt, dp, write, bootfile, or quit): <USERINPUT>write</USERINPUT>
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Quit <COMMAND>dvhtool</COMMAND>:</PARA>
<PROGRAMLISTING>
Command? (read, vd, pt, dp, write, bootfile, or quit): <USERINPUT>quit</USERINPUT>
</PROGRAMLISTING>
</LISTITEM>
</ORDEREDLIST>
</SECTION>
<SECTION  ID="LE22642-PARENT"><TITLE  ID="LE22642-TITLE">Displaying a Disk's Partitions With prtvtoc</TITLE><PARA><INDEXTERM ID="ITch2-16"><PRIMARY>disk partitions</PRIMARY>
<SECONDARY>displaying with <COMMAND>prtvtoc</COMMAND>
</SECONDARY>
</INDEXTERM>
<INDEXTERM ID="ITch2-17"><PRIMARY><COMMAND>prtvtoc</COMMAND>
 command</PRIMARY>
<SECONDARY><COMMAND>displaying disk partitions</COMMAND>
</SECONDARY>
</INDEXTERM>
Use the <COMMAND>prtvtoc</COMMAND> command to get information about the size and partitions of a disk. Only the superuser can use this command. The command is</PARA>
<PROGRAMLISTING>
# <USERINPUT>prtvtoc</USERINPUT>&ensp;<REPLACEABLE>device</REPLACEABLE>&ensp;
</PROGRAMLISTING>
<PARA>where<REPLACEABLE>&ensp;device</REPLACEABLE> is optional. When it is omitted, <COMMAND>prtvtoc</COMMAND> displays information for the system disk. <REPLACEABLE>device</REPLACEABLE> is the raw device name of the disk volume header. The <FILENAME>/dev/rdsk</FILENAME> portion of the device name can be omitted if desired. For example, for a SCSI disk that is drive address 1 on controller 0, <REPLACEABLE>device</REPLACEABLE> is <LITERAL>dks0d1vh</LITERAL>. (See <XREF LINKEND="LE34677-TITLE"><XREF LINKEND="LE59537-TITLE"> for more information on device names.)</PARA><PARA>An example of the output of <COMMAND>prtvtoc</COMMAND> is:</PARA>
<PROGRAMLISTING>
Printing label for root disk

* /dev/root (bootfile &ldquo;/unix&rdquo;)
*     512 bytes/sector
Partition  Type  Fs   Start: sec    Size: sec   Mount Directory
&ensp;0          xfs  yes        4096      4138249  
&ensp;1          raw          4142345       262144  
&ensp;8       volhdr                0         4096  
10       volume                0      4404489  
</PROGRAMLISTING>
<PARA>The output lists the partitions, their type (name or filesystem type), whether they contain a filesystem, their location on the disk (start and size in blocks and cylinders), and mount directory for filesystems. The partitions in this output are shown graphically in <XREF LINKEND="LE24282-TITLE">.</PARA></SECTION>
<SECTION  ID="LE30595-PARENT"><TITLE  ID="LE30595-TITLE">Repartitioning a Disk With xdkm</TITLE><PARA><INDEXTERM ID="ITch2-18"><PRIMARY><COMMAND>xdkm</COMMAND>
 command</PRIMARY>
</INDEXTERM>
Disks can be repartitioned using the graphical user interface of the <COMMAND>xdkm</COMMAND> command. Information about <COMMAND>xdkm</COMMAND> is available from its online help.</PARA>
</SECTION>
<SECTION  ID="LE38803-PARENT"><TITLE  ID="LE38803-TITLE">Repartitioning a Disk With fx</TITLE><CAUTION><PARA>The procedure in this section can result in the loss of data if it is not performed properly. It is recommended only for experienced IRIX system administrators.</PARA>
</CAUTION>
<PARA><INDEXTERM ID="ITch2-19"><PRIMARY>disk partitions</PRIMARY>
<SECONDARY>repartitioning with <COMMAND>fx</COMMAND>
</SECONDARY>
</INDEXTERM>
<INDEXTERM ID="ITch2-20"><PRIMARY><COMMAND>fx</COMMAND>
 command</PRIMARY>
<SECONDARY><COMMAND>repartitioning disks</COMMAND>
</SECONDARY>
</INDEXTERM>
Repartitioning disks is done from the command line with the <COMMAND>fx</COMMAND> command. There are two versions of this program, a standalone version and an IRIX version. The standalone version is invoked from the <INTERFACE>Command Monitor</INTERFACE>, which enables you to repartition the system disk. Option disks can be repartitioned using the IRIX version.</PARA>
<PARA>The subsections that follow describe the procedures for repartitioning a disk. Start with the first subsection, &ldquo;Before Repartitioning.&rdquo; Then proceed to the appropriate subsection on invoking <COMMAND>fx</COMMAND>:</PARA>
<ITEMIZEDLIST><LISTITEM><PARA><XREF LINKEND="LE41519-PARENT"></PARA></LISTITEM>
<LISTITEM><PARA><XREF LINKEND="LE85732-PARENT"></PARA></LISTITEM>
</ITEMIZEDLIST>
<PARA>The standard partition layouts described in <XREF LINKEND="LE73343-TITLE"> are &ldquo;built in to&rdquo; <COMMAND>fx</COMMAND>. You can partition a disk using one of the standard layouts or you can create custom partition layouts. Two subsections describe how to create standard and custom partition layouts:</PARA>
<ITEMIZEDLIST><LISTITEM><PARA><XREF LINKEND="LE71928-PARENT"></PARA></LISTITEM>
<LISTITEM><PARA><XREF LINKEND="LE92365-PARENT"></PARA></LISTITEM>
</ITEMIZEDLIST>
<PARA>The final subsection, <XREF LINKEND="LE75114-PARENT">, describes how to proceed after the repartitioning is complete.</PARA><SECTION  ID="LE45907-PARENT"><TITLE  ID="LE45907-TITLE">Before Repartitioning</TITLE><CAUTION><PARA>Repartitioning a disk makes the data on the disk inaccessible (you must repartition back to the original partitions to get to it).</PARA>
</CAUTION>
<PARA>Before repartitioning a disk, back up any files that contain valuable data. If the disk is a system disk and you plan to copy the files from the backup to the disk after repartitioning, you must use either the <INTERFACE>System Manager</INTERFACE> or the <COMMAND>backup</COMMAND> command. Only backups made with <COMMAND>backup</COMMAND> or the <INTERFACE>System Manager</INTERFACE> will be available to the system from the <INTERFACE>System Recovery</INTERFACE> menu of the <INTERFACE>System Maintenance </INTERFACE>menu. The <INTERFACE>System Manager</INTERFACE> is the preferred method of the two and is described completely in the <LINK BOOK="PerSysAdmin" EXTREF="96534">Personal System Administration Guide</LINK>
. Other commands require a full system installation to operate correctly.</PARA>
</SECTION>
<SECTION  ID="LE41519-PARENT"><TITLE  ID="LE41519-TITLE">Invoking fx From the Command Monitor</TITLE><PARA><INDEXTERM ID="ITch2-21"><PRIMARY><COMMAND>fx</COMMAND>
 command</PRIMARY>
<SECONDARY><COMMAND>standalone version</COMMAND>
</SECONDARY>
</INDEXTERM>
The procedure in this section describes how to invoke the standalone version of <COMMAND>fx</COMMAND> from the <INTERFACE>Command Monitor</INTERFACE>. It is only necessary for the system disk. You can use the IRIX version of <COMMAND>fx</COMMAND> for other disks (see, <XREF LINKEND="LE85732-PARENT">).</PARA><ORDEREDLIST><LISTITEM><PARA>Shut the system down into the <INTERFACE>System Maintenance </INTERFACE>menu.</PARA>
</LISTITEM>
<LISTITEM><PARA>Bring up the <INTERFACE>Command Monitor</INTERFACE> by choosing the fifth item on the <INTERFACE>System Maintenance </INTERFACE>menu.</PARA>
</LISTITEM>
<LISTITEM><PARA>Identify the copy of <COMMAND>fx</COMMAND> that you will boot. Some possible locations are: <COMMAND>fx</COMMAND> in the <FILENAME>/stand</FILENAME> directory of the system disk or <COMMAND>fx</COMMAND> on an IRIX software distribution CD in a CD-ROM drive on the local system or on a remote system.</PARA>
<PARA>A single copy of <COMMAND>fx</COMMAND> is in the <FILENAME>/stand</FILENAME> directory, but IRIX software distribution CDs contain several processor-specific versions of <COMMAND>fx</COMMAND>. Booting <COMMAND>fx</COMMAND> from a CD on a local CD-ROM drive requires a processor-specific copy of <COMMAND>sash</COMMAND> on the CD, too. </PARA>
<PARA><INDEXTERM ID="ITch2-22"><PRIMARY><COMMAND>fx</COMMAND>
 command</PRIMARY>
<SECONDARY><COMMAND>versions for different processors</COMMAND>
</SECONDARY>
</INDEXTERM>
<XREF LINKEND="LE11162-TITLE"> shows which versions of <COMMAND>sash</COMMAND> and <COMMAND>fx</COMMAND> to use according to your processor type.</PARA>
<TABLE FRAME="topbot"><TBLTITLE  ID="LE11162-TITLE">sash and fx Versions<INDEXTERM ID="ITch2-23"><PRIMARY>CPUs</PRIMARY>
<SECONDARY>and versions of <COMMAND>sash</COMMAND>
</SECONDARY>
</INDEXTERM>
<INDEXTERM ID="ITch2-24"><PRIMARY>CPUs</PRIMARY>
<SECONDARY>and versions of <COMMAND>fx</COMMAND>
</SECONDARY>
</INDEXTERM>
</TBLTITLE>
<TGROUP COLS="3">
<COLSPEC COLWIDTH="222*">
<COLSPEC COLWIDTH="156*">
<COLSPEC COLWIDTH="134*">
<THEAD><ROW><ENTRY><PARA>Processor Type</PARA></ENTRY>
<ENTRY><PARA>sash Version</PARA></ENTRY>
<ENTRY><PARA>fx Version</PARA></ENTRY>
</ROW>
</THEAD>
<TBODY><ROW><ENTRY><PARA>IP17 </PARA></ENTRY>
<ENTRY><PARA>sashIP17 </PARA></ENTRY>
<ENTRY><PARA>fx.IP17 </PARA></ENTRY>
</ROW>
<ROW><ENTRY><PARA>IP19, IP20, IP22 </PARA></ENTRY>
<ENTRY><PARA>sashARCS </PARA></ENTRY>
<ENTRY><PARA>fx.ARCS </PARA></ENTRY>
</ROW>
<ROW><ENTRY><PARA>IP21, IP25, IP26, IP27 </PARA></ENTRY>
<ENTRY><PARA>sash64 </PARA></ENTRY>
<ENTRY><PARA>fx.64 </PARA></ENTRY>
</ROW>
</TBODY>
</TGROUP>
</TABLE>
</LISTITEM>
<LISTITEM><PARA>Boot <COMMAND>fx</COMMAND> from the <INTERFACE>Command Monitor</INTERFACE>. The command to boot <COMMAND>fx</COMMAND> depends upon the location of the copy of you are booting.</PARA>
<ITEMIZEDLIST><LISTITEM><PARA>This command boots <COMMAND>fx</COMMAND> from the <FILENAME>/stand</FILENAME> directory on the system disk:</PARA>
<PROGRAMLISTING>
&gt;&gt; <USERINPUT>boot stand/fx --x</USERINPUT>&ensp;
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>This command boots <COMMAND>fx</COMMAND> from an IRIX software release CD in a local CD-ROM drive, where the CPU type of the system is IP19, IP20, or IP22 and the CD-ROM drive is at drive address 4 on controller 0:</PARA>
<PROGRAMLISTING>
&gt;&gt; <USERINPUT>boot -f dksc(0,4,8)sashARCS dksc(0,4,7)stand/fx.ARCS --x</USERINPUT>&ensp;
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>This command boots <COMMAND>fx</COMMAND> from an IRIX software release CD in a CD-ROM drive mounted at <FILENAME>/CDROM</FILENAME> on a remote system named dist, where the CPU type of the local system is IP21, IP25, IP26, or IP27:</PARA>
<PROGRAMLISTING>
&gt;&gt; <USERINPUT>boot -f bootp()dist:/CDROM/stand/fx.64 --x</USERINPUT>&ensp;
</PROGRAMLISTING>
</LISTITEM>
</ITEMIZEDLIST>
</LISTITEM>
<LISTITEM><PARA><COMMAND>fx </COMMAND>prompts you for each part of the disk name. The default answer is in parentheses and matches the system disk. The prompts are:</PARA>
<PROGRAMLISTING>
fx: "device-name" = (dksc)
fx: ctlr# = (0)
fx: drive# = (1)
fx: lun# = (0)<USERINPUT>&ensp;</USERINPUT>
</PROGRAMLISTING>
<PARA>The default device name is <FILENAME>dksc</FILENAME>, which indicates a SCSI disk on a SCSI controller. (See the <COMMAND>fx(1M)</COMMAND> reference page for other device names.) The next two prompts ask you to specify the disk controller number and the drive address (unit) of the disk. The final prompt asks for the lun (logical unit) number. The logical unit number is typically used by only a few SCSI devices such as RAIDs (an array of disks with built-in redundancy) to address disks within the device. For regular disks, use logical unit number 0.</PARA>
<PARA>For each prompt, press the <KEYCAP>Enter</KEYCAP> key for the default value or enter another value, followed by <KEYCAP>Enter</KEYCAP>.</PARA>
<PARA>Once you answer the prompts, <COMMAND>fx</COMMAND> performs a disk drive test and you see the <COMMAND>fx</COMMAND> main menu:</PARA>
<PROGRAMLISTING>
---- please choose one (? for help. .. to quit this menu)----
[exi]t               [d]ebug/                [l]abel/
[b]adblock/          [exe]rcise/             [r]epartition/
fx&gt;
</PROGRAMLISTING>
<PARA>The <COMMAND>exit</COMMAND> option quits <COMMAND>fx</COMMAND>, while the other commands take you to submenus. (The slash [/] character after a menu option indicates that choosing that option leads to a submenu.) For complete information on all <COMMAND>fx</COMMAND> options, see the <COMMAND>fx</COMMAND>(1M) reference page. </PARA>
</LISTITEM>
</ORDEREDLIST>
</SECTION>
<SECTION  ID="LE85732-PARENT"><TITLE  ID="LE85732-TITLE">Invoking fx From IRIX</TITLE><PARA><INDEXTERM ID="ITch2-25"><PRIMARY><COMMAND>fx</COMMAND>
 command</PRIMARY>
<SECONDARY><COMMAND>IRIX version</COMMAND>
</SECONDARY>
</INDEXTERM>
The procedure in this section describes how to invoke <COMMAND>fx</COMMAND> from IRIX. </PARA>
<ORDEREDLIST><LISTITEM><PARA>Make sure that the disk drive to be partitioned is not in use. That is, make sure that no filesystems are mounted and no programs are accessing the drive.</PARA>
</LISTITEM>
<LISTITEM><PARA>As superuser, give the <COMMAND>fx</COMMAND> command:</PARA>
<PROGRAMLISTING>
# <USERINPUT>fx "</USERINPUT><REPLACEABLE>controller_type</REPLACEABLE><USERINPUT>(</USERINPUT><REPLACEABLE>controller</REPLACEABLE><USERINPUT>,</USERINPUT><REPLACEABLE>address</REPLACEABLE><USERINPUT>,</USERINPUT><REPLACEABLE>logical_unit</REPLACEABLE><USERINPUT>)"</USERINPUT>
</PROGRAMLISTING>
<PARA>The variables are:</PARA>
<DEFLIST><DEFLISTENTRY><TERM><REPLACEABLE>controller_type</REPLACEABLE></TERM>
<LISTITEM><PARA>The controller type. It is dksc for SCSI controllers. For other controller types, see the <COMMAND>fx</COMMAND>(1M) reference page.</PARA>
</LISTITEM>
</DEFLISTENTRY>
<DEFLISTENTRY><TERM><REPLACEABLE>controller</REPLACEABLE></TERM>
<LISTITEM><PARA>The controller number for the disk.</PARA>
</LISTITEM>
</DEFLISTENTRY>
<DEFLISTENTRY><TERM><REPLACEABLE>address</REPLACEABLE></TERM>
<LISTITEM><PARA>The drive address of the disk. </PARA>
</LISTITEM>
</DEFLISTENTRY>
<DEFLISTENTRY><TERM><REPLACEABLE>logical_unit</REPLACEABLE></TERM>
<LISTITEM><PARA>The logical unit number for the device. It is used by only a few SCSI devices such as RAIDs (an array of disks with built-in redundancy) to address disks within the device. The <REPLACEABLE>logical_unit</REPLACEABLE> is normally 0.</PARA>
</LISTITEM>
</DEFLISTENTRY>
<DEFLISTENTRY><TERM>If you give the <COMMAND>q</COMMAND> command without arguments, you are prompted for these values.</TERM>
</DEFLISTENTRY>
</DEFLIST>
<PARA></PARA>
<PARA><COMMAND>fx</COMMAND> first performs a drive test, then displays this menu:</PARA>
<PROGRAMLISTING>
---- please choose one (? for help. .. to quit this menu)----
[exi]t               [d]ebug/                [l]abel/
[b]adblock/          [exe]rcise/             [r]epartition/
fx&gt;
</PROGRAMLISTING>
<PARA>The <COMMAND>exit</COMMAND> option quits <COMMAND>fx</COMMAND>, while the other commands take you to submenus. (The slash [/] character after a menu option indicates that choosing that option leads to a submenu.) For complete information on all <COMMAND>fx</COMMAND> options, see the <COMMAND>fx(1M)</COMMAND> reference page. </PARA>
</LISTITEM>
</ORDEREDLIST>
</SECTION>
<SECTION  ID="LE71928-PARENT"><TITLE  ID="LE71928-TITLE">Creating Standard Partition Layouts</TITLE><PARA><INDEXTERM ID="ITch2-26"><PRIMARY>disk partitions</PRIMARY>
<SECONDARY>creating standard layouts</SECONDARY>
</INDEXTERM>
This section shows the procedure for repartitioning a disk so that it has one of the standard partition layouts. The example in this section changes a disk from separate root and <FILENAME>usr</FILENAME> partitions to a combined root and <FILENAME>usr</FILENAME> partition.</PARA>
<ORDEREDLIST><LISTITEM><PARA>From the <COMMAND>fx</COMMAND> main menu, choose the <COMMAND>repartition</COMMAND>&ensp;<COMMAND>o</COMMAND>ption: </PARA>
<PROGRAMLISTING>
---- please choose one (? for help. .. to quit this menu)----
[exi]t              [d]ebug/             [l]abel/
[b]adblock/         [exe]rcise/          [r]epartition/
fx&gt; <USERINPUT>repartition</USERINPUT>

----- partitions-----
part  type        blocks          Megabytes   (base+size)
&ensp; 0: efs        3024 + 50652         1 + 25   
&ensp; 1: raw       53676 + 81648        26 + 40   
&ensp; 6: efs      135324 + 1925532      66 + 940  
&ensp; 8: volhdr        0 + 3024          0 + 1    
&ensp;10: volume        0 + 2060856       0 + 1006 

capacity is 2061108 blocks

----- please choose one (? for help, .. to quit this menu)-----
[ro]otdrive           [o]ptiondrive         [e]xpert
[u]srrootdrive        [re]size
</PROGRAMLISTING>
<PARA>You see the partition layout for the disk that you specified when <COMMAND>fx</COMMAND> was started, followed by the repartition menu. The <COMMAND>rootdrive</COMMAND>, <COMMAND>usrrootdrive</COMMAND>, and <COMMAND>optiondrive</COMMAND> options are used for standard partition layouts, and the <COMMAND>resize</COMMAND> option is used for custom partition layouts. The <COMMAND>expert</COMMAND> option, which appears only if <COMMAND>fx</COMMAND> is invoked with the <COMMAND>-x</COMMAND> option, enables custom partitioning functions. These functions can severely damage the disk when performed incorrectly, so they are unavailable unless explicitly requested with <COMMAND>-x</COMMAND>.</PARA>
</LISTITEM>
<LISTITEM><PARA>To create a combined root and <FILENAME>usr</FILENAME> partition, choose the <COMMAND>rootdrive</COMMAND> option.</PARA>
<PROGRAMLISTING>
fx/repartition&gt; <USERINPUT>rootdrive</USERINPUT>
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>A prompt appears that asks about the partition type. The possible types are shown in <XREF LINKEND="LE53955-TITLE">. For this example, choose <COMMAND>efs</COMMAND>:</PARA>
<PROGRAMLISTING>
fx/repartition/rootdrive: type of data partition = (xfs) <USERINPUT>efs</USERINPUT>
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>A warning appears; answer yes to the prompt after the warning:</PARA>
<PROGRAMLISTING WIDTH="wide">
Warning: you will need to re-install all software and restore user data
from backups after changing the partition layout.  Changing partitions
will cause all data on the drive to be lost.  Be sure you have the drive
backed up if it contains any user data.  Continue? <USERINPUT>yes</USERINPUT>

----- partitions-----
part  type        blocks          Megabytes   (base+size)
&ensp; 0: efs        3024 + 1976184       1 + 965  
&ensp; 1: raw     1979208 + 81648       966 + 40   
&ensp; 8: volhdr        0 + 3024          0 + 1    
&ensp;10: volume        0 + 2060856       0 + 1006 

capacity is 2061108 blocks

----- please choose one (? for help, .. to quit this menu)-----
[ro]otdrive        [u]srrootdrive     [o]ptiondrive      [re]size
</PROGRAMLISTING>
<PARA>The partition layout after repartitioning is displayed and the repartition submenu appears again.</PARA>
</LISTITEM>
<LISTITEM><PARA>To return to the <COMMAND>fx</COMMAND> main menu, enter <LITERAL>..</LITERAL> at the prompt:</PARA>
<PROGRAMLISTING>
fx/repartition&gt; <USERINPUT>..</USERINPUT>

----- please choose one (? for help, .. to quit this menu)-----
[exi]t               [d]ebug/             [l]abel/
[b]adblock/          [exe]rcise/          [r]epartition/
fx&gt; 
</PROGRAMLISTING>
</LISTITEM>
</ORDEREDLIST>
</SECTION>
<SECTION  ID="LE92365-PARENT"><TITLE  ID="LE92365-TITLE">Creating Custom Partition Layouts</TITLE><PARA><INDEXTERM ID="ITch2-27"><PRIMARY>disk partitions</PRIMARY>
<SECONDARY>creating custom layouts</SECONDARY>
</INDEXTERM>
The following procedure describes how to repartition a disk so that it has a custom partition layout. As an example, this procedure repartitions a 380 MB SCSI drive to increase the size of the root partition. </PARA>
<ORDEREDLIST><LISTITEM><PARA>At the <COMMAND>fx</COMMAND> main menu, choose the <COMMAND>repartition</COMMAND> command:</PARA>
<PROGRAMLISTING>
---- please choose one (? for help. .. to quit this menu)----
[exi]t              [d]ebug/             [l]abel/
[b]adblock/         [exe]rcise/          [r]epartition/
fx&gt; <USERINPUT>repartition</USERINPUT>
----- partitions-----
part  type        blocks          Megabytes   (base+size)
&ensp; 0: efs        2835 + 32400         1 + 16
&ensp; 1: rawdata   35235 + 81810        17 + 40
&ensp; 6: efs      117045 + 513945       57 + 251
&ensp; 7: efs        2835 + 628155        1 + 307
&ensp; 8: volhdr        0 + 2835          0 + 1
&ensp;10: entire        0 + 630990        0 + 308

capacity is 631017 blocks

----- please choose one (? for help, .. to quit this menu)-----
[ro]otdrive        [u]srrootdrive     [o]ptiondrive      [re]size
</PROGRAMLISTING>
<PARA>You see the partition layout for the disk that you specified when <COMMAND>fx</COMMAND> was started, followed by the repartition menu. Look at the size column for partitions 0, 1, and 6. In this example, you have 32400 + 81810 + 513945 = 628155 blocks to use. Look at the start block numbers, and notice that partition 7 overlaps 0, 1, and 6. Partition 0 is the root filesystem, and is mounted on the system's root directory (/). Partition 1 is your system's swap space. Partition 6 is the <FILENAME>usr</FILENAME> filesystem, and it is mounted on the <FILENAME>/usr</FILENAME> directory. In this example, you will take space from the <FILENAME>usr</FILENAME> filesystem and expand the root filesystem.</PARA>
</LISTITEM>
<LISTITEM><PARA>Choose the <COMMAND>resize</COMMAND> option to change the size of partitions on the disk and answer <USERINPUT>y</USERINPUT> to the warning message:</PARA>
<PROGRAMLISTING WIDTH="wide">
fx/repartition&gt; <USERINPUT>resize</USERINPUT>

Warning: you will need to re-install all software and restore user data
from backups after changing the partition layout.  Changing partitions
will cause all data on the drive to be lost.  Be sure you have the drive
backed up if it contains any user data.  Continue? <USERINPUT>y</USERINPUT>

After changing the partition, the other partitions will
be adjusted around it to fit the change.  The result will be
displayed and you will be asked whether it is OK, before the
change is committed to disk.  Only the standard partitions may
be changed with this function.  Type ? at prompts for a list
of possible choices
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>The prompt after the warning message offers the swap space partition as the default partition to change, but in this example you will designate the root partition to be resized. Enter <LITERAL>root</LITERAL> at the prompt: </PARA>
<PROGRAMLISTING>
fx/repartition/resize: partition to change = (swap) <USERINPUT>root</USERINPUT>
current:  type efs       base:     2835 blks,    1 Mb
&ensp;             len:    32400 blks,  16 Mb
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>The next prompt asks for the partitioning method (partition size units) with megabytes as the default. Other options are to use percentages of total disk space or numbers of disk blocks. Megabytes and percentages are the easiest methods to use to partition your disk. Press <KEYCAP>Enter</KEYCAP> to use megabytes as the method of repartitioning:</PARA>
<PROGRAMLISTING WIDTH="wide">
fx/repartition/resize: partitioning method = (megabytes (2^20 bytes)) <USERINPUT>Enter</USERINPUT>
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>The next prompt asks for the size of the root partition in megabytes. The default is the current size of the partition. For this example, increase the size to 20 MB:</PARA>
<PROGRAMLISTING>
fx/repartition/resize: size in megabytes (max 307) = (16) <USERINPUT>20</USERINPUT>
----- partitions-----
part  type        blocks          Megabytes   (base+size)
&ensp; 0: efs        2835 + 40960         1 + 20
&ensp; 1: rawdata   43795 + 73250        21 + 36
&ensp; 6: efs      117045 + 513945       57 + 251
&ensp; 8: volhdr        0 + 2835          0 + 1
&ensp;10: entire        0 + 630990        0 + 308
</PROGRAMLISTING>
<PARA>The new partition map is displayed. Note that the 4 megabytes that you added to your root partition were taken from the swap partition. Ultimately, you want those megabytes to come from the <FILENAME>usr</FILENAME> partition, but for the moment, accept the new partition layout. </PARA>
</LISTITEM>
<LISTITEM><PARA>To accept the new partition layout, enter <LITERAL>yes</LITERAL> at the prompt: </PARA>
<PROGRAMLISTING>
Use the new partition layout? (no) <USERINPUT>yes</USERINPUT>
</PROGRAMLISTING>
<PARA>The new partition table is printed again, along with the total disk capacity. Then you are returned to the repartition menu. </PARA>
</LISTITEM>
<LISTITEM><PARA>Select <COMMAND>resize</COMMAND> again to transfer space from the <FILENAME>usr</FILENAME> partition to the swap area:</PARA>
<PROGRAMLISTING>
fx/repartition&gt;<USERINPUT>&ensp;resize</USERINPUT>
</PROGRAMLISTING>
<PARA>You see the same warning message again.</PARA>
</LISTITEM>
<LISTITEM><PARA>At the partition to change prompt, press <KEYCAP>Enter</KEYCAP> to change the size of the swap partition:</PARA>
<PROGRAMLISTING>
fx/repartition/resize: partition to change = (swap) <USERINPUT>Enter</USERINPUT>
current:  type raw       base:   43795 blks,   21 Mb
&ensp;                         len:   73250 blks,   36 Mb
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Press <KEYCAP>Enter</KEYCAP> again to use megabytes as the method of repartition: </PARA>
<PROGRAMLISTING WIDTH="wide">
fx/repartition/resize: partitioning method = (megabytes (2^20 bytes)) <USERINPUT>Enter</USERINPUT>
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>The next prompt requests the new size of the swap partition. Since you added 4&nbsp;megabytes to expand the root filesystem from 16 to 20 megabytes, enter <LITERAL>40</LITERAL> and press <KEYCAP>Enter</KEYCAP> at this prompt to expand the swap space to its original size. (If your system is chronically short of swap space, you can take this opportunity to add some space by entering a higher number.)</PARA>
<PROGRAMLISTING>
fx/repartition/resize: size in megabytes (max 307) = (36) <USERINPUT>40</USERINPUT>
----- partitions-----
part  type        blocks          Megabytes   (base+size)
&ensp; 0: efs        2835 + 40960         1 + 20
&ensp; 1: rawdata   43795 + 81920        21 + 40
&ensp; 6: efs      125715 + 505275       61 + 247
&ensp; 8: volhdr        0 + 2835          0 + 1
&ensp;10: entire        0 + 630990        0 + 308
</PROGRAMLISTING>
<PARA>You see the new partition table. Note that the partition table now reflects that 4&nbsp;megabytes have been taken from partition 6 (<FILENAME>usr</FILENAME>) and placed in the swap partition. </PARA>
</LISTITEM>
<LISTITEM><PARA>At the prompt, enter <LITERAL>yes</LITERAL> to accept the new partition layout: </PARA>
<PROGRAMLISTING>
Use the new partition layout? (no) <USERINPUT>yes</USERINPUT>
</PROGRAMLISTING>
<PARA>The new partition table and the repartition submenu are displayed again. </PARA>
</LISTITEM>
<LISTITEM><PARA>Enter <LITERAL>..</LITERAL> at the prompt to return to the <COMMAND>fx</COMMAND> main menu:</PARA>
<PROGRAMLISTING>
fx/repartition&gt; <USERINPUT>..</USERINPUT>

----- please choose one (? for help, .. to quit this menu)-----
[exi]t               [d]ebug/             [l]abel/
[b]adblock/          [exe]rcise/          [r]epartition/
fx&gt; 
</PROGRAMLISTING>
</LISTITEM>
</ORDEREDLIST>
</SECTION>
<SECTION  ID="LE75114-PARENT"><TITLE  ID="LE75114-TITLE">After Repartitioning</TITLE><ORDEREDLIST><LISTITEM><PARA>From the <COMMAND>fx</COMMAND> main menu, enter <LITERAL>exit</LITERAL> to quit <COMMAND>fx</COMMAND>.</PARA>
<PROGRAMLISTING>
fx&gt; <USERINPUT>exit</USERINPUT>
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>If you repartitioned the system disk, you must now install software on it in one of two ways:</PARA>
<ITEMIZEDLIST><LISTITEM><PARA>Bring up the miniroot (choose Install System Software from the <INTERFACE>System Maintenance </INTERFACE>menu); use the <COMMAND>mkfs</COMMAND> command on the<INTERFACE>&ensp;Administrative Commands</INTERFACE> menu to make filesystems on the disk partition; and install an IRIX release and optional software.</PARA>
</LISTITEM>
<LISTITEM><PARA>Choose System Recovery from the <INTERFACE>System Maintenance </INTERFACE>menu and use the backup or system manager backup tape you created earlier to return the original files to the disk.</PARA>
<PARA>If you repartitioned an option disk, use the <COMMAND>mkfs</COMMAND> command to create new filesystems on the disk partitions. </PARA>
</LISTITEM>
</ITEMIZEDLIST>
</LISTITEM>
<LISTITEM><PARA>Restore user files from backup tapes as necessary.</PARA>
</LISTITEM>
</ORDEREDLIST>
</SECTION>
</SECTION>
<SECTION  ID="LE50592-PARENT"><TITLE  ID="LE50592-TITLE">Creating Mnemonic Names for Device Files With ln</TITLE><PARA><INDEXTERM ID="ITch2-28"><PRIMARY>device files</PRIMARY>
<SECONDARY>creating mnemonic names</SECONDARY>
</INDEXTERM>
<INDEXTERM ID="ITch2-29"><PRIMARY>mnemonic device file names</PRIMARY>
</INDEXTERM>
<INDEXTERM ID="ITch2-30"><PRIMARY><COMMAND>ln</COMMAND>
 command</PRIMARY>
<SECONDARY><COMMAND>creating mnemonic names</COMMAND>
</SECONDARY>
</INDEXTERM>
<INDEXTERM ID="ITch2-31"><PRIMARY>device names</PRIMARY>
<SECONDARY>mnemonic</SECONDARY>
</INDEXTERM>
Device file names, for example <FILENAME>/dev/dsk/dks0d1s0</FILENAME> and <FILENAME>/dev/rdsk/dks0d2s7</FILENAME>, can be difficult to remember and type. <FIRSTTERM>Mnemonic device names</FIRSTTERM> can solve this problem. They are filenames in the <FILENAME>/dev</FILENAME> directory that are symbolic links to the real device files. By default, IRIX has several of these mnemonic device file names. For example, <FILENAME>/dev/root</FILENAME> is a mnemonic device file name for <FILENAME>/dev/dsk/dks0d1s0</FILENAME> (or whatever partition contains the root filesystem) and <FILENAME>/dev/rswap</FILENAME> is a mnemonic device file name for <FILENAME>/dev/rdsk/dks0d1s1</FILENAME> (or whatever partition is the swap partition). You can create additional mnemonic device file names using the <COMMAND>ln</COMMAND> command:</PARA>
<PROGRAMLISTING>
# <USERINPUT>ln</USERINPUT>&ensp;<REPLACEABLE>device_file</REPLACEABLE>&ensp;<REPLACEABLE>mnemonic_name</REPLACEABLE>&ensp;
</PROGRAMLISTING>
<PARA>For more information on the <COMMAND>ln</COMMAND> command, see the <COMMAND>ln</COMMAND>(1) reference page.</PARA>
</SECTION>
<SECTION  ID="LE12802-PARENT"><TITLE  ID="LE12802-TITLE">Creating a System Disk From the PROM Monitor</TITLE><PARA><INDEXTERM ID="ITch2-32"><PRIMARY>system disks</PRIMARY>
<SECONDARY>creating from the PROM Monitor</SECONDARY>
</INDEXTERM>
This section describes how to install a system disk on a system that does not currently have a working system disk. It is used in these situations:</PARA>
<ITEMIZEDLIST><LISTITEM><PARA>The new disk has no formatting or partitioning information on it at all, or the partitioning is incorrect.</PARA>
</LISTITEM>
<LISTITEM><PARA>It is an option disk that you must turn into a system disk.</PARA>
</LISTITEM>
</ITEMIZEDLIST>
<PARA>If the system already has a working disk, you can use the procedure in<XREF LINKEND="LE43185-PARENT">&ensp;</PARA><PARA> To turn a disk into a system disk, you must have an IRIX system software release CD available and a CD-ROM drive attached to the system or available on the network. If you are using a CD-ROM drive attached to a system on the network, that system must be set up as an installation server. See the <LINK BOOK="IA_InstLicns" EXTREF="29804">IRIX Admin: Software Installation and Licensing</LINK>
 guide for instructions.</PARA>
<PARA>These instructions assume that the system disk is installed on controller 0 at drive address 1. This is the standard location for workstations; the controller number is system-specific on servers. Follow these steps:</PARA>
<ORDEREDLIST><LISTITEM><PARA>Bring the system up into the <INTERFACE>System Maintenance</INTERFACE> menu. </PARA>
</LISTITEM>
<LISTITEM><PARA>Invoke the <INTERFACE>Command Monitor</INTERFACE> by choosing the fifth item on the <INTERFACE>System Maintenance </INTERFACE>menu.</PARA>
</LISTITEM>
<LISTITEM><PARA>Issue the <COMMAND>hinv</COMMAND> command, and use the CPU type and <XREF LINKEND="LE11162-TITLE"> to determine the version of standalone <COMMAND>fx</COMMAND> that you need to invoke. For example, a system with an IP19 processor is an ARCS processor, so the version of standalone <COMMAND>fx</COMMAND> needed is <FILENAME>stand/fx.ARCS</FILENAME>.</PARA>
</LISTITEM>
<LISTITEM><PARA>Determine the controller and drive address of the device that contains the copy of <COMMAND>fx</COMMAND> that you plan to use (a CD-ROM drive attached to the system or a CD-ROM drive on a workstation on the network). For example, for a local CD-ROM drive, if <COMMAND>hinv</COMMAND> reports that the CD-ROM drive on the system is scsi(0), cdrom(4), the controller is 0 and the drive address is 4. The remainder of this example uses that device, although your device may be different or may be located on a different workstation. </PARA>
</LISTITEM>
<LISTITEM><PARA>If you are installing over a network connection, get the IP address of the workstation with the CD-ROM drive.</PARA>
</LISTITEM>
<LISTITEM><PARA>Insert the CD containing the IRIX system software release into the CD-ROM drive. </PARA>
</LISTITEM>
<LISTITEM><PARA><INDEXTERM ID="ITch2-33"><PRIMARY><COMMAND>fx</COMMAND>
 command</PRIMARY>
<SECONDARY><COMMAND>repartitioning example</COMMAND>
</SECONDARY>
</INDEXTERM>
<INDEXTERM ID="ITch2-34"><PRIMARY>repartitioning</PRIMARY>
<SECONDARY>example</SECONDARY>
</INDEXTERM>
Give a <INTERFACE>Command Monitor</INTERFACE> command to boot <COMMAND>fx</COMMAND>. For this example the command is:</PARA>
<PROGRAMLISTING>
&gt;&gt; <USERINPUT>boot -f dksc(0,4,8)sashARCS dksc(0,4,7)stand/fx.ARCS --x</USERINPUT>&ensp;
72912+9440+3024+331696+23768d+3644+5808 entry: 0x89f9a950
112784+28720+19296+2817088+59600d+7076+10944 entry: 0x89cd74d0
SGI Version 5.3 ARCS   Oct 18, 1994
</PROGRAMLISTING>
<PARA>See Appendix A of the guide <LINK BOOK="IA_InstLicns" EXTREF="29804">IRIX Admin: Software Installation and Licensing</LINK>
 for a complete listing of appropriate commands to boot <COMMAND>fx</COMMAND> from CD-ROM on this or another workstation.</PARA>
</LISTITEM>
<LISTITEM><PARA>Respond to the prompts by pressing the <KEYCAP>Enter</KEYCAP> key. These responses select the system disk:</PARA>
<PROGRAMLISTING>
fx: &ldquo;device-name&rdquo; = (dksc) 
fx: ctlr# = (0) <USERINPUT>Enter</USERINPUT>
fx: drive# = (1) <USERINPUT>Enter</USERINPUT>
fx: lun# = (0)<USERINPUT>&ensp;</USERINPUT>
...opening dksc(0,1,)
...drive selftest...OK
Scsi drive type == SGI     SEAGATE ST31200N8640

----- please choose one (? for help, .. to quit this menu)-----
[exi]t             [d]ebug/           [l]abel/           [a]uto
[b]adblock/        [exe]rcise/        [r]epartition/     [f]ormat
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Display the partitioning of the disk with the <COMMAND>repartition</COMMAND> command:</PARA>
<PROGRAMLISTING>
fx&gt; <USERINPUT>repartition</USERINPUT>

----- partitions-----
part  type        blocks          Megabytes   (base+size)
&ensp; 7: efs        3048 + 2074164       1 + 1013 
&ensp; 8: volhdr        0 + 3048          0 + 1    
&ensp;10: volume        0 + 2077212       0 + 1014 

capacity is 2077833 blocks
</PROGRAMLISTING>
<PARA>Check the partition layout to see whether the disk needs repartitioning. See <XREF LINKEND="LE73343-TITLE"> for information about standard partition layouts.</PARA></LISTITEM>
<LISTITEM><PARA>If the disk doesn't need repartitioning, skip to step 13<!-- This hardcoded numeric reference should be updated. -->.</PARA>
</LISTITEM>
<LISTITEM><PARA>Choose a disk partition layout. You can choose a standard system disk partition layout (described in <XREF LINKEND="LE73343-TITLE">) or a custom partition layout. </PARA></LISTITEM>
<LISTITEM><PARA>If you choose a standard system disk partition layout, follow the directions in <XREF LINKEND="LE71928-PARENT">. If you choose a custom partition layout, follow the instructions in <XREF LINKEND="LE92365-PARENT">. </PARA></LISTITEM>
<LISTITEM><PARA>In preparation for a future step, check the contents of the volume header by giving this command:</PARA>
<PROGRAMLISTING WIDTH="wide">
----- please choose one (? for help, .. to quit this menu)-----
[ro]otdrive           [o]ptiondrive         [e]xpert
[u]srrootdrive        [re]size
fx/repartition&gt; <USERINPUT>label/show/directory</USERINPUT>

&ensp;0: sgilabel   block    3 size     512  2: sash       block 1914 size  159232
&ensp;1: ide        block    4 size  977920
</PROGRAMLISTING>
<PARA>Verify that the volume header contains <COMMAND>sash</COMMAND>, a required file (it is listed as item 2 in this example). </PARA>
</LISTITEM>
<LISTITEM><PARA>Quit <COMMAND>fx</COMMAND> and the <INTERFACE>Command Monitor</INTERFACE> so that you return to the <INTERFACE>System Maintenance </INTERFACE>menu:</PARA>
<PROGRAMLISTING>
----- please choose one (? for help, .. to quit this menu)-----
[para]meters       [part]itions       [b]ootinfo         [a]ll
[g]eometry         [s]giinfo          [d]irectory
fx/label/show&gt; <USERINPUT>../../exit</USERINPUT>
&gt;&gt; <USERINPUT>exit</USERINPUT>
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Choose the second option, <INTERFACE>Install System Software</INTERFACE>, from the <INTERFACE>System Maintenance </INTERFACE>menu. </PARA>
<PARA>Because there is no filesystem on the root partition, error messages may appear. One example is the following message: </PARA>
<PROGRAMLISTING>
Mounting file systems:

/dev/dsk/dks0d1s0: Invalid argument
No valid file system found on: /dev/dsk/dks0d1s0
This is your system disk: without it we have nothing
on which to install software.
</PROGRAMLISTING>
<PARA>Another possible message indicates a problem, but does mount the root partition and bring up <COMMAND>inst</COMMAND>:</PARA>
<PROGRAMLISTING>
Mounting file systems:

mount: /root/dev/usr on /root/usr: No such file or directory
mount: giving up on:
&ensp;  /root/usr

Unable to mount all local efs, xfs file systems under /root
Copy of above errors left in /root/etc/fscklogs/miniroot

&ensp;   /dev/miniroot            on  /
&ensp;   /dev/dsk/dks0d1s0        on  /root

Invoking software installation.
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>If the system offers to make a filesystem, answer <USERINPUT>yes</USERINPUT> to the prompts: </PARA>
<PROGRAMLISTING WIDTH="wide">
Make new file system on /dev/dsk/dks0d1s0 [yes/no/sh/help]: <USERINPUT>yes</USERINPUT>

About to remake (mkfs) file system on: /dev/dsk/dks0d1s0
This will destroy all data on disk partition: /dev/dsk/dks0d1s0.

&ensp;       Are you sure? [y/n] (n): <USERINPUT>yes</USERINPUT>

&ensp;       Block size of filesystem 512 or 4096 bytes? <USERINPUT>4096</USERINPUT>

Doing: mkfs -b size=512 /dev/dsk/dks0d1s0
meta-data=/dev/rdsk/dks0d1s0     isize=256    agcount=8, agsize=248166 blks
data     =                       bsize=4096   blocks=248165
log      =internal log           bsize=512    blocks=1000
realtime =none                   bsize=4096   blocks=0, rtextents=0
Mounting file systems:

NOTICE: Start mounting filesystem: /root
NOTICE: Ending clean XFS mount for filesystem: /root
&ensp;   /dev/miniroot            on  /
&ensp;   /dev/dsk/dks0d1s0        on  /root
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>If the system offers to put you into a shell, go into the shell and manually make the root and, if appropriate, the <FILENAME>usr</FILENAME> filesystem. For example:</PARA>
<PROGRAMLISTING WIDTH="wide">
Please manually correct your configuration and try again.

&ensp;       Press Enter to invoke C Shell csh: <USERINPUT>Enter</USERINPUT>

# <USERINPUT>mkfs /dev/dsk/dks0d1s0</USERINPUT>&ensp;
meta-data=/dev/dsk/dks0d1s0      isize=256    agcount=8, agsize=31021 blks
data     =                       bsize=4096   blocks=248165
log      =internal log           bsize=4096   blocks=1000
realtime =none                   bsize=4096   blocks=0, rtextents=0
# <USERINPUT>exit</USERINPUT>
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>If the <COMMAND>inst</COMMAND> main menu comes up and you did not make a root filesystem in step 16<!-- This hardcoded numeric reference should be updated. --> or step 17<!-- This hardcoded numeric reference should be updated. -->, make the root and, if used, the <FILENAME>usr</FILENAME> filesystems, and mount them. For example:</PARA>
<PROGRAMLISTING WIDTH="wide">
Inst&gt; <USERINPUT>admin</USERINPUT>
...
Admin&gt; <USERINPUT>mkfs /dev/dsk/dks0d1s0</USERINPUT>

Make new file system on /dev/dsk/dks0d1s0 [yes/no/sh/help]: <USERINPUT>yes</USERINPUT>

About to remake (mkfs) file system on: /dev/dsk/dks0d1s0
This will destroy all data on disk partition: /dev/dsk/dks0d1s0.

&ensp;       Are you sure? [y/n] (n): <USERINPUT>yes</USERINPUT>

&ensp;       Block size of filesystem 512 or 4096 bytes? <USERINPUT>4096</USERINPUT>

Doing: mkfs -b size=512 /dev/dsk/dks0d1s0
meta-data=/dev/rdsk/dks0d1s0     isize=256    agcount=8, agsize=248166 blks
data     =                       bsize=4096   blocks=248165
log      =internal log           bsize=512    blocks=1000
realtime =none                   bsize=4096   blocks=0, rtextents=0
Mounting file systems:

NOTICE: Start mounting filesystem: /root
NOTICE: Ending clean XFS mount for filesystem: /root
&ensp;   /dev/miniroot            on  /
&ensp;   /dev/dsk/dks0d1s0        on  /root


Re-initializing installation history database
Reading installation history .. 100% Done.
Checking dependencies .. 100% Done.

Admin&gt; <USERINPUT>Enter</USERINPUT>
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Install IRIX software from the CD as usual.</PARA>
</LISTITEM>
<LISTITEM><PARA>Install option software and patches from other CDs, if desired.</PARA>
</LISTITEM>
<LISTITEM><PARA>If you don't need to modify the volume header to add <COMMAND>sash</COMMAND> (see step 13<!-- This hardcoded numeric reference should be updated. -->),you have finished creating the new system disk. You don't need to do the remaining steps in this procedure.</PARA>
</LISTITEM>
<LISTITEM><PARA>In preparation for adding programs to the volume header of the disk, start a shell:</PARA>
<PROGRAMLISTING>
Inst&gt; <USERINPUT>sh</USERINPUT>
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Follow the instructions in the procedure in <XREF LINKEND="LE85263-PARENT"> to add <COMMAND>sash</COMMAND>, if necessary, to the volume header of the system disk. Remember that the <FILENAME>/stand</FILENAME> directory is mounted at <FILENAME>/root/stand</FILENAME>.</PARA>
</LISTITEM>
<LISTITEM><PARA>Exit from the shell:</PARA>
<PROGRAMLISTING>
# <USERINPUT>exit</USERINPUT>
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Quit <COMMAND>inst</COMMAND> and bring up the system as usual.</PARA>
<PROGRAMLISTING>
Inst&gt; <USERINPUT>quit</USERINPUT>
</PROGRAMLISTING>
</LISTITEM>
</ORDEREDLIST>
</SECTION>
<SECTION  ID="LE43185-PARENT"><TITLE  ID="LE43185-TITLE">Creating a New System Disk From IRIX</TITLE><PARA><INDEXTERM ID="ITch2-35"><PRIMARY>system disks</PRIMARY>
<SECONDARY>creating from IRIX</SECONDARY>
</INDEXTERM>
<INDEXTERM ID="ITch2-36"><PRIMARY>option disks</PRIMARY>
<SECONDARY>turning into a system disk</SECONDARY>
</INDEXTERM>
This procedure describes how to turn an option disk into a system disk. The option disk does not need to have a filesystem or be mounted prior to starting the procedure.</PARA>
<CAUTION><PARA>The procedure in this section destroys all data on the option disk. If the option disk contains files that you want to save, back up all files on the option disk to tape or another disk before beginning this procedure.</PARA>
</CAUTION>
<PARA>You can use this procedure when you want to change to a larger system disk, for example from a 1 GB disk to a 2 GB disk, or when you want to create a system disk that you can move to another system. With this procedure, you create a &ldquo;fresh&rdquo; disk by installing software from an IRIX system software CD. (To create an exact copy of a system disk, use <XREF LINKEND="LE77121-PARENT"> instead.) Note that if you plan to create a system disk for another system, the systems must be identical because of hardware dependencies in IRIX. </PARA><PARA>You must perform this procedure as superuser. The procedure requires several system reboots, so other users should not be using the system.</PARA>
<PARA>Follow these steps to convert an option disk to a system disk:</PARA>
<ORDEREDLIST><LISTITEM><PARA>Using <COMMAND>hinv</COMMAND>, determine the controller and drive addresses of the disk to be turned into a system disk. In this procedure, the example commands and output assume that the disk is on controller 0 and drive address 2. Substitute your controller and drive address throughout these instructions.</PARA>
</LISTITEM>
<LISTITEM><PARA><INDEXTERM ID="ITch2-37"><PRIMARY><COMMAND>fx</COMMAND>
 command</PRIMARY>
<SECONDARY><COMMAND>repartitioning example</COMMAND>
</SECONDARY>
</INDEXTERM>
<INDEXTERM ID="ITch2-38"><PRIMARY>repartitioning</PRIMARY>
<SECONDARY>example</SECONDARY>
</INDEXTERM>
To repartition the disk so that it can be used as a system disk, begin by invoking <COMMAND>fx</COMMAND>:</PARA>
<PROGRAMLISTING>
# <USERINPUT>fx</USERINPUT>&ensp;
fx version 6.4, Sep 29, 1996
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Answer the prompts with the correct controller number and drive address for the disk you are converting and 0 for the lun number, for example:</PARA>
<PROGRAMLISTING>
fx: &ldquo;device-name&rdquo; = (dksc) <USERINPUT>Enter</USERINPUT>
fx: ctlr# = (0) <USERINPUT>Enter</USERINPUT>
fx: drive# = (1) <USERINPUT>2</USERINPUT>
fx: lun# = (0) <USERINPUT>Enter</USERINPUT>
...opening dksc(0,2,0)
...drive selftest...OK
Scsi drive type == SGI     SEAGATE ST31200N8640

----- please choose one (? for help, .. to quit this menu)-----
[exi]t               [d]ebug/             [l]abel/
[b]adblock/          [exe]rcise/          [r]epartition/
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Enter the <COMMAND>repartition</COMMAND> command:</PARA>
<PROGRAMLISTING>
fx&gt; <USERINPUT>repartition</USERINPUT>

----- partitions-----
part  type        blocks          Megabytes   (base+size)
&ensp; 7: efs        3024 + 2057832       1 + 1005
&ensp; 8: volhdr        0 + 3024          0 + 1
&ensp;10: volume        0 + 2060856       0 + 1006

capacity is 2061108 blocks
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Choose <COMMAND>rootdrive</COMMAND> or <COMMAND>usrrootdrive</COMMAND>, depending on whether you want a combined root and <FILENAME>usr</FILENAME> partition or separate root and <FILENAME>usr</FILENAME> partitions. (See the section <XREF LINKEND="LE73343-TITLE"> for advantages and disadvantages of each.) In this example, a combined root and <FILENAME>usr</FILENAME> disk, configured for XFS, is chosen:</PARA>
<PROGRAMLISTING WIDTH="wide">
----- please choose one (? for help, .. to quit this menu)-----
[ro]otdrive        [u]srrootdrive     [o]ptiondrive      [re]size

fx/repartition&gt; <USERINPUT>rootdrive</USERINPUT>

fx/repartition/rootdrive: type of data partition = (xfs) <USERINPUT>Enter</USERINPUT>
Warning: you will need to re-install all software and restore user data
from backups after changing the partition layout.  Changing partitions
will cause all data on the drive to be lost.  Be sure you have the drive
backed up if it contains any user data.  Continue? <USERINPUT>y</USERINPUT>
----- partitions-----
part  type        blocks          Megabytes   (base+size)
&ensp; 0: xfs        3024 + 1976184       1 + 965  
&ensp; 1: raw     1979208 + 81648       966 + 40   
&ensp; 8: volhdr        0 + 3024          0 + 1    
&ensp;10: volume        0 + 2060856       0 + 1006 

capacity is 2061108 blocks
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Quit <COMMAND>fx</COMMAND>:</PARA>
<PROGRAMLISTING>
----- please choose one (? for help, .. to quit this menu)-----
[ro]otdrive        [u]srrootdrive     [o]ptiondrive      [re]size
fx/repartition&gt; <USERINPUT>../exit</USERINPUT>
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Use the procedure in <XREF LINKEND="LE85263-PARENT"> to examine the contents of the volume header of the disk to be converted and to add <COMMAND>sash</COMMAND> to its volume header if it is not there already.</PARA>
</LISTITEM>
<LISTITEM><PARA>Make a root filesystem on the root partition of the disk you are converting. For example, to make an XFS root filesystem with 4 KB block size and a 1000 block internal log (the default values), give this command:</PARA>
<PROGRAMLISTING>
# <USERINPUT>mkfs /dev/dsk/dks0d2s0</USERINPUT>&ensp;
</PROGRAMLISTING>
<PARA>For additional instructions on making an XFS filesystem, see <XREF LINKEND="LE82948-TITLE"> and <XREF LINKEND="LE72328-TITLE">. There is no need to mount the filesystem after making it.</PARA></LISTITEM>
<LISTITEM><PARA>If the disk has a separate <FILENAME>usr</FILENAME> partition, make a filesystem on that partition, too. For example:</PARA>
<PROGRAMLISTING>
# <USERINPUT>mkfs /dev/dsk/dks0d2s6</USERINPUT>&ensp;
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Insert a CD containing the IRIX release you plan to install into either your system's CD-ROM drive or a CD-ROM drive on a remote system.</PARA>
</LISTITEM>
<LISTITEM><PARA>Shut down the system and bring up the miniroot from the CD. For instructions, see the guide <LINK BOOK="IA_InstLicns" EXTREF="29804">IRIX Admin: Software Installation and Licensing</LINK>
. </PARA>
</LISTITEM>
<LISTITEM><PARA>Switch to the <INTERFACE>Administrative Commands</INTERFACE> menu, unmount the root and <FILENAME>usr</FILENAME> (if used) partitions from the old system disk, and mount the root and <FILENAME>usr</FILENAME> (if used) partitions of the new disk in their place. For example, if the old system disk has root and <FILENAME>usr</FILENAME> partitions and the new system disk has only a root partition, the commands are:</PARA>
<PROGRAMLISTING>
Inst&gt; <USERINPUT>admin</USERINPUT>
Admin&gt; <USERINPUT>umount /root</USERINPUT>
Admin&gt; <USERINPUT>umount /root/usr</USERINPUT>
Admin&gt; <USERINPUT>mount /dev/dsk/dks0d2s0 /root</USERINPUT>
Admin&gt; <USERINPUT>Enter</USERINPUT>
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Confirm that the root and <FILENAME>usr</FILENAME> (if used) partitions of the new system disk are mounted as <FILENAME>/root</FILENAME> and <FILENAME>/root/usr</FILENAME> (if used). This example shows the output for the example in step 12<!-- This hardcoded numeric reference should be updated. -->:</PARA>
<PROGRAMLISTING>
Inst&gt; <USERINPUT>sh df</USERINPUT>

Filesystem             Type  blocks     use     avail  %use Mounted on
/dev/miniroot           xfs    49000    32812    16188  67  /
/dev/dsk/dks0d1s0       xfs  1984325      251  1984074   0  /root
</PROGRAMLISTING>
<CAUTION><PARA>If the wrong partitions are mounted, <COMMAND>inst</COMMAND> installs system software onto the wrong partitions, which destroys the data on those partitions.</PARA>
</CAUTION>
</LISTITEM>
<LISTITEM><PARA>Install system software from this CD and options and patches from other CDs as usual. Instructions are in the guide <LINK BOOK="IA_InstLicns" EXTREF="29804">IRIX Admin: Software Installation and Licensing</LINK>
.</PARA>
</LISTITEM>
<LISTITEM><PARA>Quit <COMMAND>inst</COMMAND> and bring the system back to IRIX (the system boots the old system disk).</PARA>
</LISTITEM>
<LISTITEM><PARA>To test the new system disk before replacing the old system disk or moving the disk to a different system, begin by shutting down the system to the PROM Monitor.</PARA>
</LISTITEM>
<LISTITEM><PARA>Bring up the <INTERFACE>Command Monitor</INTERFACE> by choosing the fifth item on the <INTERFACE>System Maintenance</INTERFACE> menu.</PARA>
</LISTITEM>
<LISTITEM><PARA>Boot the system in single user mode from the new system disk by issuing the following commands. This example uses controller 0 and drive address 2; substitute the values for the new system disk in the first and second positions of each of the three triples of numbers in this example.</PARA>
<PROGRAMLISTING>
&gt;&gt; <USERINPUT>setenv initstate s</USERINPUT>&ensp;
&gt;&gt; <USERINPUT>boot -f dksc(0,2,8)sash dksc(0,2,0)unix root=dks0d2s0</USERINPUT>&ensp;
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Run <COMMAND>MAKEDEV</COMMAND> and <COMMAND>autoconfig</COMMAND>:</PARA>
<PROGRAMLISTING>
# <USERINPUT>cd /dev</USERINPUT>&ensp;
# <USERINPUT>./MAKEDEV</USERINPUT>&ensp;
# <USERINPUT>/etc/autoconfig -f</USERINPUT>&ensp;
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Restart the system in multiuser mode with the <COMMAND>reboot</COMMAND> command.</PARA>
</LISTITEM>
</ORDEREDLIST>
<PARA>The new system disk is ready to replace the system disk on this system or another system with the same hardware configuration.&ensp;</PARA>
</SECTION>
<SECTION  ID="LE77121-PARENT"><TITLE  ID="LE77121-TITLE">Creating a New System Disk by Cloning</TITLE><PARA><INDEXTERM ID="ITch2-39"><PRIMARY>system disks</PRIMARY>
<SECONDARY>creating by cloning</SECONDARY>
</INDEXTERM>
<INDEXTERM ID="ITch2-40"><PRIMARY>cloning system disks</PRIMARY>
</INDEXTERM>
This procedure describes how to turn an option disk into an exact copy of a system disk. Use this procedure when you want to set up two or more systems with identical system disks. The systems must have identical processor and graphics types.</PARA>
<CAUTION><PARA>The procedure in this section destroys all data on the option disk. If the option disk contains files that you want to save, back up all files on the option disk to tape or another disk before beginning this procedure.</PARA>
</CAUTION>
<PARA>You must perform this procedure as superuser. To ensure that the system disk that you create is identical to the original system disk, the system should be in single user mode.</PARA>
<ORDEREDLIST><LISTITEM><PARA>List the disk partitioning of the system (root) disk by invoking <COMMAND>prtvtoc</COMMAND> without parameters, for example:</PARA>
<PROGRAMLISTING>
# <USERINPUT>prtvtoc</USERINPUT>
Printing label for root disk

* /dev/root (bootfile &ldquo;/unix&rdquo;)
*     512 bytes/sector
Partition  Type  Fs   Start: sec    Size: sec   Mount Directory
&ensp;0          xfs  yes        4096      4138249  
&ensp;1          raw          4142345       262144  
&ensp;8       volhdr                0         4096  
10       volume                0      4404489  
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>List the disk partitioning of the option disk that is to be the clone, for example:</PARA>
<PROGRAMLISTING>
# <USERINPUT>prtvtoc /dev/rdsk/dks0d2vh</USERINPUT>
...
Partition  Type  Fs   Start: sec    Size: sec   Mount Directory
&ensp;0          efs             3024        50652
&ensp;1          raw            53676        81648
&ensp;6          efs           135324      1925532
&ensp;8       volhdr                0         3024
10       volume                0      2060856
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Compare the disk partitioning of the two disks. They must have the same layout for the root and (if used) the <FILENAME>usr</FILENAME> partition. If they are not the same, repartition the option disk to match the system disk using the procedure in <XREF LINKEND="LE38803-PARENT">.</PARA></LISTITEM>
<LISTITEM><PARA>Use the procedure in <XREF LINKEND="LE85263-PARENT"> to check the contents of the volume header of the option disk and add programs, if necessary, by copying them from the system disk.</PARA></LISTITEM>
<LISTITEM><PARA>Make a new filesystem on the root partition of the option disk. For example, to make an XFS root filesystem with a 4 KB block size and a 1000 block internal log (the default values), give this command:</PARA>
<PROGRAMLISTING>
# <USERINPUT>mkfs /dev/dsk/dks0d2s0</USERINPUT>&ensp;
</PROGRAMLISTING>
<PARA>For additional instructions on making an XFS filesystem, see <XREF LINKEND="LE82948-TITLE"> and <XREF LINKEND="LE72328-TITLE">. There is no need to mount the filesystem after making it.</PARA></LISTITEM>
<LISTITEM><PARA>If there is a separate <FILENAME>usr</FILENAME> partition, make a new filesystem on the <FILENAME>usr</FILENAME> partition of the option disk, for example:</PARA>
<PROGRAMLISTING>
# <USERINPUT>mkfs /dev/dsk/dks0d2s6</USERINPUT>&ensp;
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Create a temporary mount point for the option disk filesystems, for example:</PARA>
<PROGRAMLISTING>
# <USERINPUT>mkdir /clone</USERINPUT>&ensp;
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Mount the root filesystem of the option disk and change directories to the mount point, for example:</PARA>
<PROGRAMLISTING>
# <USERINPUT>mount /dev/dsk/dks0d2s0 /clone</USERINPUT>&ensp;
# <USERINPUT>cd /clone</USERINPUT>&ensp;
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Use <COMMAND>dump</COMMAND> (for EFS filesystems) or <COMMAND>xfsdump</COMMAND> (for XFS filesystems) to copy the root filesystem on the system disk to the root filesystem of the option disk. The <COMMAND>dump</COMMAND> command is:</PARA>
<PROGRAMLISTING>
# <USERINPUT>dump 0f - / | restore xf -</USERINPUT>&ensp;
</PROGRAMLISTING>
<PARA>The <COMMAND>xfsdump</COMMAND> command is:</PARA>
<PROGRAMLISTING>
# <USERINPUT>xfsdump -l 0 - / | xfsrestore -</USERINPUT> . 
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>If the disks do not have a <FILENAME>usr</FILENAME> partition, skip to step 13<!-- This hardcoded numeric reference should be updated. -->.</PARA>
</LISTITEM>
<LISTITEM><PARA>In preparation for copying the <FILENAME>usr</FILENAME> filesystem, mount the <FILENAME>usr</FILENAME> filesystem instead of the root filesystem:</PARA>
<PROGRAMLISTING>
# <USERINPUT>cd ..</USERINPUT>
# <USERINPUT>umount /clone</USERINPUT>
# <USERINPUT>mount /dev/dsk/dks0d2s6 /clone</USERINPUT>
# <USERINPUT>cd /clone</USERINPUT>
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Use <COMMAND>dump</COMMAND> (for EFS filesystems) or <COMMAND>xfsdump</COMMAND> (for XFS filesystems) to copy the <FILENAME>usr</FILENAME> filesystem on the system disk to the <FILENAME>usr</FILENAME> filesystem of the option disk. The <COMMAND>dump</COMMAND> command is:</PARA>
<PROGRAMLISTING>
# <USERINPUT>dump 0f - /usr | restore xf -</USERINPUT>&ensp;
</PROGRAMLISTING>
<PARA>The <COMMAND>xfsdump</COMMAND> command is:</PARA>
<PROGRAMLISTING>
# <USERINPUT>xfsdump -l 0 - /usr | xfsrestore -</USERINPUT> . 
</PROGRAMLISTING>
</LISTITEM>
<LISTITEM><PARA>Unmount the filesystem mounted at the temporary mount point and remove the mount point, for example:</PARA>
<PROGRAMLISTING>
# <USERINPUT>cd ..</USERINPUT>
# <USERINPUT>umount /clone</USERINPUT>&ensp;
# <USERINPUT>rmdir /clone</USERINPUT>&ensp;
</PROGRAMLISTING>
<PARA>The option disk is now an exact copy of the system disk. It can be moved to a system with the same hardware configuration.</PARA>
</LISTITEM>
</ORDEREDLIST>
</SECTION>
<SECTION  ID="LE71954-PARENT"><TITLE  ID="LE71954-TITLE">Adding a New Option Disk</TITLE><TIP><PARA>You can use the Disk Manager in the System Toolchest to add a new option disk. For instructions, see <LINK BOOK="PerSysAdmin" EXTREF="14758">&ldquo;Setting Up a New Hard Disk</LINK>
&rdquo; in Chapter 3 of the <CITETITLE>Personal System Administration Guide</CITETITLE>. The section <LINK BOOK="PerSysAdmin" EXTREF="95419">&ldquo;Taking Advantage of a Second Disk&rdquo;</LINK>
 in Chapter 6 of the <CITETITLE>Personal System Administration Guide</CITETITLE> provides ideas for making effective use of an option disk.</PARA>
</TIP>
<PARA><INDEXTERM ID="ITch2-41"><PRIMARY>option disks</PRIMARY>
<SECONDARY>adding a new</SECONDARY>
</INDEXTERM>
To add a new option disk to a system using shell commands, follow these steps: </PARA>
<ORDEREDLIST><LISTITEM><PARA>Install the hardware. See the owner's guide for the system.</PARA>
</LISTITEM>
<LISTITEM><PARA>Initialize the volume header, if necessary. See <XREF LINKEND="LE27674-PARENT">. </PARA></LISTITEM>
<LISTITEM><PARA>Partition the new disk, if necessary. It should be partitioned as an option disk. See <XREF LINKEND="LE38803-PARENT"> for instructions.</PARA></LISTITEM>
<LISTITEM><PARA>In preparation for the next step, identify the type of controller that the new disk is attached to (integral SCSI controller or non-integral controller). See the section <XREF LINKEND="LE75051-PARENT"> for instructions.</PARA></LISTITEM>
<LISTITEM><PARA>To add an option disk on an integral SCSI controller to a system, use the <COMMAND>Add_disk</COMMAND> command to perform the remaining steps to configure the disk:</PARA>
<PROGRAMLISTING>
# <USERINPUT>Add_disk</USERINPUT>&ensp;<REPLACEABLE>controller_number</REPLACEABLE>&ensp;<REPLACEABLE>drive_address lun_number</REPLACEABLE>
</PROGRAMLISTING>
<PARA>If you are adding a second disk on controller 0 to your system, you do not have to specify the disk, controller number, or logical unit number; adding disk 2 on controller 0 is the default. If you are adding a third (or greater) disk, or if you are adding a disk on a controller other than controller 0, you must specify the disk and controller. If the disk device has a logical unit number different from zero, it must be specified.</PARA>
<PARA><COMMAND>Add_disk</COMMAND> checks for valid filesystems on the disk, and if any filesystems are present, you are warned and asked for permission before the existing filesystems are destroyed and a new filesystem is made.</PARA>
<PARA>The <COMMAND>Add_disk</COMMAND> command performs these tasks:</PARA>
<ITEMIZEDLIST><LISTITEM><PARA>Creates the character and raw device files for the new disk</PARA>
</LISTITEM>
<LISTITEM><PARA>Creates an XFS filesystem on the disk</PARA>
</LISTITEM>
<LISTITEM><PARA>Creates the mount directory</PARA>
</LISTITEM>
<LISTITEM><PARA>Mounts the filesystem</PARA>
</LISTITEM>
<LISTITEM><PARA>Adds the mount order to the <FILENAME>/etc/fstab</FILENAME> file</PARA>
</LISTITEM>
</ITEMIZEDLIST>
</LISTITEM>
<LISTITEM><PARA>For an option disk on a non-integral controller, complete the configuration of the new option disk by making a filesystem. Use the instructions in one of these sections in <XREF LINKEND="LE35942-TITLE">: <XREF LINKEND="LE72328-TITLE"> or <XREF LINKEND="LE67358-TITLE">.</PARA></LISTITEM>
</ORDEREDLIST>
</SECTION>
</CHAPTER>
