<HTML>
<HEAD>
<TITLE>Diskless Workstation Administration Guide
</TITLE></HEAD>
<BODY BGCOLOR="#F9F9F9">
<!-- dtlbook2html START -->
<HR noshade>
<FONT SIZE="-1"><A HREF="index.html"><B>Diskless Workstation Administration Guide</B></A><P><A HREF="Diskless_AG-9.html"><IMG SRC="images/b_prev.gif" ALT="Prev" WIDTH=17 HEIGHT=17 BORDER=0 ALIGN=TOP></A>&nbsp; <A HREF="Diskless_AG-11.html"><IMG SRC="images/b_next.gif" ALT="Next" WIDTH=17 HEIGHT=17 BORDER=0 ALIGN=TOP></A>&nbsp;&nbsp;&nbsp;&nbsp;Table of Contents:&nbsp;&nbsp;<A HREF="index.html">Basic</A>&nbsp;&nbsp;|&nbsp;&nbsp;<A HREF="fulltoc.html">Expanded</A></P></FONT>
<!-- dtlbook2html END -->

<A NAME=X></A><HR noshade><A NAME="SGI1"></A>
<H1 class="SGITPL-head">Chapter 7<BR> Troubleshooting Diskless Installations</h1><p>This chapter provides information to help you correct problems that might occur in your diskless implementation. It also explains what to do before you call the Silicon Graphics Technical Assistance Center and how to prepare for your call if you determine that one is necessary. <p>This chapter contains these sections:<ul><li><A HREF="Diskless_AG-10.html#SGI2" TARGET=_top>"General Approach to Troubleshooting"</A><br><br><li><A HREF="Diskless_AG-10.html#SGI3" TARGET=_top>"Troubleshooting Checklist"</A><br><br><li><A HREF="Diskless_AG-10.html#SGI4" TARGET=_top>"Installation Error Messages"</A><br><br><li><A HREF="Diskless_AG-10.html#SGI5" TARGET=_top>"Removing a Diskless Class Manually"</A><br><br><li><A HREF="Diskless_AG-10.html#SGI6" TARGET=_top>"Debugging the Boot Process"</A><br><br><li><A HREF="Diskless_AG-10.html#SGI12" TARGET=_top>"Before You Call for Help"</A></ul><HR noshade><A NAME="SGI2"></A>
<h2 class="SGITPL-head">General Approach to Troubleshooting</h2><p>Frequently, problems with a diskless implementation are due to problems with the network on which it is implemented. If your diskless service is not working as expected, first determine whether there are network problems and correct any you find; then look at the diskless environment to correct any problems that persist. <p>Problems that are specific to the diskless environment are usually caused by one of these general conditions: <ul><li>Diskless software is improperly configured. <br><br><li>The boot process is not completing successfully. </ul><HR noshade><A NAME="SGI3"></A>
<h2 class="SGITPL-head">Troubleshooting Checklist</h2><p>Some problems you might encounter with your diskless configuration can be solved by considering these questions: <ol><li>Did you install an official IRIX release that both the client and server support? <p>If you suspect that the software you are using is not an officially released version of IRIX (such as beta software, for example), remove and reinstall the share tree and any client trees made from the share tree.<br><br><li>Has any software in the diskless tree been modified because <i>share_inst</i> or <i>client_inst</i> installed it? <p>You can answer this question with a simple test. Try to remove the client tree with <i>client_inst</i>. At the beginning of this procedure, <i>client_inst</i> checks various tables and files to verify that they are in the same form as when it built them. If <i>client_inst</i> finds anything changed, it refuses to remove the client tree. <P><B>Note: </B>You can safely do this test without deleting the client tree, because <i>client_inst</i> will ask you for confirmation before it removes anything on the tree. <br><br><li>Are hardware variables set correctly in <i>share.dat</i> and <i>client.dat</i>?<p>Values for <var>CPUBOARD</var><i>, </i><var>CPUARCH</var>, <var>GFXBOARD</var>, and <var>VIDEO </var>must be set correctly during software installation and should not be changed once the share tree is built. All hardware settings in individual <i>client.dat</i> files must be represented by a corresponding setting in the <i>share.dat</i> file that defines their share tree. <br><br><li>Did you try to run <i>lboot</i> on the share tree or a client tree? <p>If you ran <i>lboot</i>, remove and reinstall all software on any share and client tree where you ran this utility. <br><br><li>Are the versions of IRIX on the share tree suitable for the server? <p>Although you can run any version of IRIX on a server, the share trees it supports cannot be running later software versions than the server itself. To eliminate the possibility of compatibility problems, it is recommended that the version of IRIX on share trees be the same as the version of IRIX on the server supporting them, particularly if you are running maintenance releases. </ol><HR noshade><A NAME="SGI4"></A>
<h2 class="SGITPL-head">Installation Error Messages</h2><p><A HREF="Diskless_AG-10.html#SGITF1" TARGET=_top>Table 7-1</A> shows error messages that can be displayed when you are using <i>share_inst</i> or <i>client_inst</i> to build a diskless tree. It also suggests what you can do to correct the problems.<TABLE BORDER CELLPADDING=10><p><A NAME="SGITF1"></A><CAPTION ALIGN=TOP><B>Table 7-1 :  </B>Installation Error Messages</CAPTION><TR VALIGN=TOP ALIGN=LEFT><TH>error messages</TH><TH>check here</TH><TR ALIGN=LEFT VALIGN=TOP><TD><p><TT>/var/boot/classname.dat not 
found</TT></TD><TD><p>The <i>client.dat</i> file for the share tree that 
<i>client_inst</i> is trying to build is missing. 
Check <i>/var/boot </i>to make sure that the 
appropriate <i>client.dat</i> is listed and check 
your spelling of the file name.</TD></TR><TR ALIGN=LEFT VALIGN=TOP><TD><p><TT>Invalid hostname_clientname</TT></TD><TD><p><i>client_inst</i> cannot find the client's name in 
a hosts database. If NIS=no in the 
configuration file for this client, check the 
server's local <i>/etc/hosts</i> file for the client's 
entry. If NIS=yes in the configuration file 
for this client, check the NIS hosts 
database for the client and verify that the 
diskless server is an NIS client.</TD></TR><TR ALIGN=LEFT VALIGN=TOP><TD><p><var>&lt;clientname</var><TT></TT><TT>&gt; is not a diskless 
client for CLASS classname</TT></TD><TD><p>You are trying to remove a client from the 
wrong diskless server or <i>client_inst</i> cannot 
determine the client-server relationship. 
If NIS=no in the configuration file for this 
client, check the server's local 
<i>/etc/bootparams</i> file for correct entries. If 
NIS=yes in the configuration file for this 
client, check the NIS <i>bootparams</i> database 
and verify that the diskless server is an 
NIS client.</TD></TR></TABLE> <br><br><HR noshade><A NAME="SGI5"></A>
<h2 class="SGITPL-head">Removing a Diskless Class Manually</h2><p>When you cannot use <i>share_inst</i> or <i>client_inst </i>to remove diskless software, use this procedure to remove a diskless tree manually. Do this procedure as the superuser on the server. <ol><li>Remove the share tree. <p>This command sequence changes to the root directory for share trees and removes the share tree <i>IRIX_51</i>, using the recursive option of the <i>rm</i> commands: <PRE># <B>cd /diskless/share</B>
# <B>rm -r IRIX_51</B></PRE><li>Remove the client trees. <p>This command sequence changes to the root directory for client trees and removes the client tree for <i>starlite</i>. Repeat the <i>rm -r</i> command for each client you need to remove: <PRE># <B>cd /diskless/client</B>
# <B>rm -r starlite</B></PRE><li>Remove the swap trees in the class. <p>This command sequence changes to the root directory for swap trees and removes the swap tree for <i>starlite</i>. Repeat the <i>rm -r</i> command for each client you need to remove: <PRE># <B>cd /diskless/swap</B>
# <B>rm -r starlite</B></PRE><li>Clean the <i>/etc/exports</i> file on the server. <p>The share and client tree entries are listed in the server's <i>/etc/exports</i> file. Delete them individually to prevent unintentional deletion of other information, as shown in these examples:<PRE># <B>export -u /diskless/client/starlite</B>
# <B>export -u /diskless/swap/starlite</B>
# <B>export -u /diskless/share/IRIX_51</B></PRE><li>Clean unwanted entries in the <i>/etc/bootparams</i> file on the server: <p>If you want to retain other share trees, be very careful. You should delete only the individual entries for an unwanted client or share tree. An <i>/etc/bootparams</i> entry looks like the following example.<PRE>    dayglo.bldg9.dude.com root=babylon:/d1/client/dayglo \
         sbin=babylon:/d1/share/5_1/sbin swap=babylon:/d1/swap/daglo\
    5_1.a109 root=babylon:/diskless/sh109/5_1.a109 sbin=babylon: swap=babylon:</PRE></ol><HR noshade><A NAME="SGI6"></A>
<h2 class="SGITPL-head">Debugging the Boot Process</h2><p>Occasionally, a client does not boot after a diskless software installation or upgrade.  A number of factors can contribute to this problem.  To diagnose booting problems, it is helpful to understand the boot process in some detail. The four phases of the boot process are described below. <A NAME="SGI7"></A>
<h3 class="SGITPL-head">Phase 1: The Boot Request</h3><p>In phase 1, the diskless client initiates a <i>bootp</i> request. This request can be in the form of a broadcast going to all servers on the same network, or a specific request to a known diskless server. If a router is installed between the server and its client, the router must be configured to forward <i>bootp</i> requests (see the -f argument to <i>bootp</i> in the bootp(1M) reference page). The transport mechanism is the User Datagram Protocol (UDP/IP).  <p>Once the <i>bootp</i> request reaches the diskless server, the super server inetd starts the <i>bootp</i> server.  <i>bootp</i> is responsible for resolving the client's identity by examining its configuration file, <i>/var/bootptab</i>, the <i>/etc/ethers</i> file, and the <i>/etc/hosts</i> file, in that order.  The <i>bootp</i> server is also responsible for resolving the boot filetoname, which is specified in the client's PROM variable, <var>bootfile</var>.  <A NAME="SGI8"></A>
<h3 class="SGITPL-head">Phase 2: The Boot File Download</h3><p>When the <i>bootp</i> server has resolved the client identity and boot file location, the client sends a <i>tftpd</i> (the Trivial File Transport Protocol) request for its boot file, <i>/var/boot/client_name/unix</i>, which invokes TFTP on the server.  The server sends the kernel and the client loads it into memory. <A NAME="SGI9"></A>
<h3 class="SGITPL-head">Phase 3: The Server-Client Setup</h3><p>Once the client has loaded the kernel into memory, it initiates a broadcast RPC call to the server.  The <i>inetd</i> daemon on the diskless server starts up the <i>bootparamd</i> server. The <i>bootparamd</i> server provides the information to the diskless client necessary for booting; primarily, the location of its root, share, and swap trees.  This information is contained in the <i>bootparams</i> database file, <i>/etc/bootparams</i>, either locally or in the NIS databases.  The server-client relationship is then sent back to the client. <A NAME="SGI10"></A>
<h3 class="SGITPL-head">Phase 4: Client Request for Software</h3><p>After the server-client relationship is confirmed, the client issues an NFS request to the server for its <i>root</i>, <i>sbin</i>, and <i>swap</i> filesystems. The server then starts the <i>rpc.mountd</i> server to answer the request (<i>rpc.mountd</i> is responsible for verifying access to a filesystem by clients and users). If the client has sufficient permission to mount the requested filesystems, the mount and boot processes are completed.  <p><A HREF="Diskless_AG-10.html#SGITF3" TARGET=_top>Figure 7-1</A> explains the events in the boot process.<p><p> <A NAME="SGITF3"></A><IMG SRC="images/Fig7-1.gif" WIDTH=516 HEIGHT=296 ALT="Fig7-1.gif" BORDER=0 ALIGN=absmiddle><p><B>Figure 7-1 :  </B>Diskless Boot Process<p><br><A NAME="SGI11"></A>
<h3 class="SGITPL-head">Handling Booting Error Messages</h3><p>To see error messages that occur during the client's boot process, the NVRAM <var>verbose</var> variable must be on. To set <var>verbose</var> to <i>on</i>, use this command:<p>&gt;&gt; <TT><B>setenv verbose on</B></TT><p><A HREF="Diskless_AG-10.html#SGITF2" TARGET=_top>Table 7-2</A> describes common error messages that you can see on the client during the boot process and suggests how to correct them. <TABLE BORDER CELLPADDING=10><p><A NAME="SGITF2"></A><CAPTION ALIGN=TOP><B>Table 7-2 :  </B>Boot Process Troubleshooting Hints</CAPTION><TR VALIGN=TOP ALIGN=LEFT><TH>Client Error Messages</TH><TH>What to Check </TH><TR ALIGN=LEFT VALIGN=TOP><TD><p><i>[ec0, enp0, et0, ipg0, fxp0]: transmit: no carrier ef, me<br>no server for server: /var/boot/client/unix <br>Unable to continue: press &lt;enter&gt; to return to the menu:</i></TD><TD><p>Check the network cable to be sure that it is securely attached.</TD></TR><TR ALIGN=LEFT VALIGN=TOP><TD><p><i>no server for server: /var/boot/client/unix<br>Unable to continue: press &lt;enter&gt; to return to the menu:</i></TD><TD><p>On the client, check the NVRAM <var>netaddr</var> variable to ensure that 
it has the correct Internet address. <p>On the server, check the <i>/etc/inetd.conf</i> file to ensure that the 
<i>bootp </i>server is supported.</TD></TR><TR ALIGN=LEFT VALIGN=TOP><TD><p><i>File /var/boot/client/unix not found on server servername <br>Unable to continue: press &lt;enter&gt; to return to the menu:</i></TD><TD><p>On the client, the NVRAM bootfile variable might have the 
wrong path or bootfile name. <p>On the server, check to ensure that the bootfile specified in the 
<var>bootfile</var> variable on client actually exists.</TD></TR><TR ALIGN=LEFT VALIGN=TOP><TD><p><i>Starting up the system ...<br>Copyright message...<br>PANIC: KERNEL FAULT......</i></TD><TD><p>On the client, the <var>diskless</var> variable may not be enabled.<p>The kernel built for this client workstation might not be 
appropriate for its model type. Check the architecture variables 
in <i>client.dat</i> and <i>server.dat</i> to be sure the correct kernel modules 
have been specified.</TD></TR><TR ALIGN=LEFT VALIGN=TOP><TD><p><i>Starting up the system...<br>Unable to continue: press &lt;enter&gt; to return to the menu:</i></TD><TD><p>On the server, check the<i> /etc/inetd.conf </i>file to ensure that the 
<i>tftpd </i>server is supported and configured correctly. The default 
<i>tftpd</i> entry runs in secure mode and supports the diskless 
environment. The default entry is<br><TT>tftpd -s /var/local/boot</TT></TD></TR><TR ALIGN=LEFT VALIGN=TOP><TD><p><i>kernel mount failed, check server, bootparams <br>or press reset button!!! <br>Get_bootp failed</i></TD><TD><p>On the server, check the <i>/etc/inetd.conf</i> file to ensure that 
<i>bootparamd</i> is supported (the <i>bootparamd</i> entry is present and is 
not preceded by the comment character, #).</TD></TR><TR ALIGN=LEFT VALIGN=TOP><TD><p><i>GET_BOOTP: WHOAMI fail, addr=0x <br>Get_bootp failed <br>Kernel mount failed, check server, bootparams <br>or press reset button!!!</i></TD><TD><p>On the server or NIS master, check that the <i>/etc/bootparams</i> file 
contains valid entries for the client. If the client was created 
with NIS=yes in <i>client.dat</i>, the problem is with the NIS 
bootparams database. If  the client was created with NIS=no in 
<i>client.dat</i>, the problem is with the server's local <i>/etc/bootparams</i> 
file. Verify that <i>/var/yp/ypdomain</i> contains an entry for the 
server. </TD></TR><TR ALIGN=LEFT VALIGN=TOP><TD><p>sv1: missing<br>Portmapper not responding; still trying<p><br><br></TD><TD><p>On the server, check the <var>HOSTNAME</var> setting in <i>share.dat</i> to be 
sure that it specifies the network interface to the diskless LAN. 
If the diskless LAN is on a secondary network interface, 
<var>HOSTNAME</var> should not be set to <i>hostname </i>unless <i>/etc/sys_id</i> 
contains the name of the diskless LAN interface.</TD></TR><TR ALIGN=LEFT VALIGN=TOP><TD><p><i>Kernel mount failed, check server, bootparams <br>or press reset button!!! <br>Diskless root mount failed:</i></TD><TD><p>On the server, check the <i>/etc/exports</i>(1M) file. The diskless tree 
filesystems (<i>root</i>, <i>swap</i>, and <i>share</i>) may not be accessible to 
clients.</TD></TR><TR ALIGN=LEFT VALIGN=TOP><TD><p><i>nfs_rmount: SHARE MOUNT FAILED.</i></TD><TD><p>On the server, check the <i>/etc/exports </i>file. The share tree for this 
client may not be accessible.</TD></TR></TABLE> <br><br><HR noshade><A NAME="SGI12"></A>
<h2 class="SGITPL-head">Before You Call for Help</h2><p>Silicon Graphics support organizations are interested in your problems and are eager to help.  However, before you call, please use the recommendations in this chapter for solving your problems independently.  If your problems persist and you find it necessary to call, please have this information ready: <ul><li>Make printed copies of the <i>/etc/exports</i> and <i>/etc/bootparams</i> files for the server (not the share tree).  <br><br><li>Make printed copies of all <i>share.dat</i> and <i>client.dat</i> files in the server's <i>/var/boot</i> directory   -       one for each client class. Label them so that you can distinguish among them.  <br><br><li>Make a list of all of diskless clients that you have on the network, including workstation models, graphics board types, and hostnames.  </ul>
      

<!-- dtlbook2html START -->
<HR noshade>
<FONT SIZE="-1"><A HREF="index.html"><B>Diskless Workstation Administration Guide</B></A><P><A HREF="Diskless_AG-9.html"><IMG SRC="images/b_prev.gif" ALT="Prev" WIDTH=17 HEIGHT=17 BORDER=0 ALIGN=TOP></A>&nbsp; <A HREF="Diskless_AG-11.html"><IMG SRC="images/b_next.gif" ALT="Next" WIDTH=17 HEIGHT=17 BORDER=0 ALIGN=TOP></A>&nbsp;&nbsp;&nbsp;&nbsp;Table of Contents:&nbsp;&nbsp;<A HREF="index.html">Basic</A>&nbsp;&nbsp;|&nbsp;&nbsp;<A HREF="fulltoc.html">Expanded</A></P></FONT>
<!-- dtlbook2html END -->

<HR noshade>
</BODY>
</HTML>
